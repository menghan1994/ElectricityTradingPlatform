# Epic 3: 功率预测与数据可视化

**目标：** 交易员可以查看指定电站的96时段功率预测曲线和置信区间；系统管理员可配置和监控预测模型状态；系统每日自动通过标准化API拉取预测数据。

**FRs覆盖：** FR1, FR2, FR3, FR4

**相关NFRs：** NFR2(预测曲线加载<5秒), NFR17(新模型接入≤1人天)

---

## Story 3.1: 功率预测模型配置与监控

As a 系统管理员（老周）,
I want 配置功率预测模型的接入参数并监控其运行状态,
So that 预测模型能正常为交易员提供预测数据，异常时我能及时发现。

**Acceptance Criteria:**

**Given** 管理员已登录并进入预测模型配置页面
**When** 管理员填写模型接入参数（API端点、认证密钥、调用频率、超时时间）并保存
**Then** 模型配置保存成功，系统尝试连接验证并显示连接状态

**Given** 已配置的预测模型
**When** 管理员查看模型管理页面
**Then** 展示每个模型的运行状态（运行中/异常/已停用）

**Given** 预测模型API调用失败或超时
**When** 系统检测到异常
**Then** 模型状态自动更新为"异常"，系统在5分钟内发出告警通知并记录失败原因

**Given** 功率预测模型接口设计
**When** 需要接入新的预测模型
**Then** 仅需配置适配器参数，不需修改核心代码，新模型接入工作量≤1人天

---

## Story 3.2: 功率预测数据自动拉取

As a 系统,
I want 每个交易日自动通过标准化API拉取功率预测数据,
So that 交易员在报价前能获得最新的96时段功率预测。

**Acceptance Criteria:**

**Given** 预测模型已配置且状态为"运行中"
**When** 每交易日T-1日到达指定拉取时间
**Then** 系统自动调用预测模型API，完成当日96时段预测数据拉取（数据字段包含时段编号、预测功率kW、置信区间上下限）

**Given** API调用过程中
**When** 响应超时或调用失败
**Then** 系统在5分钟内发出告警，记录失败原因（超时/网络错误/认证失败/数据格式异常），不影响已有历史预测数据的使用

**Given** API返回预测数据
**When** 数据字段缺失或格式不符合标准
**Then** 系统记录数据质量问题并告警，不将异常数据写入正式预测结果

---

## Story 3.3: 功率预测曲线可视化

As a 交易员（李娜）,
I want 查看指定电站的96时段功率预测曲线及置信区间，并切换不同预测模型的结果,
So that 我能直观了解明天的发电预测情况，为报价决策提供参考。

**Acceptance Criteria:**

**Given** 交易员已登录并选择一个已绑定的电站
**When** 进入功率预测页面
**Then** 展示该电站的96时段功率预测曲线图，横轴为时段（1-96），纵轴为预测功率（kW），同时展示置信区间上下限（填充区域）

**Given** 系统配置了多个预测模型（MVP仅1个自有模型）
**When** 交易员在模型选择器中切换模型
**Then** 曲线图切换为所选模型的预测结果

**Given** 交易员打开预测曲线页面
**When** 页面加载完成
**Then** 预测数据加载时间<5秒（P95，10并发），加载过程中显示骨架屏

**Given** 预测数据尚未生成（模型未执行或拉取失败）
**When** 交易员访问预测页面
**Then** 页面显示"暂无预测数据"提示及最后成功拉取的时间戳

---
