---
stepsCompleted: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
inputDocuments:
  - product-brief-ElectricityTradingPlatform-2026-02-24.md
  - prd/index.md
  - prd/executive-summary.md
  - prd/project-classification.md
  - prd/user-journeys.md
  - prd/functional-requirements.md
  - prd/non-functional-requirements.md
  - prd/domain-specific-requirements.md
  - prd/innovation-novel-patterns.md
  - prd/product-scope-phased-development.md
  - prd/saas-b2b-specific-requirements.md
  - prd/success-criteria.md
  - prd-validation-report/index.md
---

# UX Design Specification ElectricityTradingPlatform

**Author:** hmeng
**Date:** 2026-02-25

---

<!-- UX design content will be appended sequentially through collaborative workflow steps -->

## Executive Summary

### Project Vision

ElectricityTradingPlatform 是面向中石油体系内新能源公司的AI电力交易决策平台，核心理念为"AI做分析，人做决策"。平台通过多Agent协作（LangGraph架构）完成功率预测、电价预测、报价策略生成、储能调度优化和风控审计的端到端决策链路，交易员审核AI建议后做最终判断。

平台首期聚焦日前市场96时段报价优化和储能联合调度，以历史回测系统作为核心卖点，用真实数据证明"AI策略比人工交易多赚多少钱"，契合国资企业"实证为王"的决策心理。MVP目标3个月交付可演示的端到端产品，以中石油1家省级新能源公司为试点。

**核心竞争力：可解释AI。** Agent决策链路可视化是本平台的UX杀手锏——让用户"看到AI是怎么想的"。在中国电力交易市场，竞品（清鹏智能走黑箱AI、国能日新无Agent架构）均无法提供此能力，而国资企业的合规审计要求天然需要决策可追溯，使可解释AI同时成为差异化优势和合规刚需。

### Target Users

| 用户角色 | 代表人物 | 技术水平 | 使用频率 | 核心诉求 | 设备 |
|---------|---------|---------|---------|---------|------|
| 交易员 | 李娜，28岁，电气工程硕士 | 中等 | 每个交易日，高频操作 | 减轻96时段手工报价负担，AI辅助减少失误 | 桌面Web |
| 交易部门负责人 | 赵磊，40岁，行业15年 | 中等偏业务 | 每日监控 + 月度汇报 | 团队交易质量标准化，收益可追踪可归因 | 桌面Web |
| 管理层 | 王总，50岁，国资体系 | 低，不直接操作 | 低频（月度/季度） | ROI数据——"AI能多赚多少钱" | 桌面Web（只读） |
| 系统管理员/配置员 | 老周，资深交易员 | 中等，非IT人员 | 初期配置 + 日常维护 | 无需IT介入即可完成配置 | 桌面Web |
| 储能运维员 | 陈工，35岁，运维工程师 | 中等偏工程 | 每日执行调度 | 清晰充放电指令，设备安全约束被识别 | 桌面Web |

**MVP UX资源分配优先级：**

- **演示路径优先（60%）：** 回测分析页 + 收益看板——面向王总/赵磊的"数据叙事级"视觉冲击力，这是获得试点部署拍板的关键
- **操作路径保底（30%）：** 交易工作台 + 储能调度页——确保李娜/陈工的核心流程跑通不卡壳，保证最低可用性
- **配置最简（10%）：** 系统配置页——功能可用即可，向导式引导但不追求打磨

### Key Design Challenges

1. **复杂信息密度 vs 决策效率**：交易员需在早上7:30-9:00窗口期内审核96时段AI报价建议+储能调度计划。需展示足够的决策支撑信息（Agent推理链路、置信度、收益预估），又不能信息过载导致决策迟缓
2. **多角色差异化视角**：同一套数据需为5种角色提供差异化呈现——交易员需操作面板、主管需管理看板、高管需一页纸汇报、运维需设备指令视图
3. **AI信任渐进式建立**：国资企业背景下交易员对AI天然不信任，UX需设计从"可解释"→"可追溯"→"数据自证"的渐进信任路径
4. **源储协同可视化**：功率预测、电价预测、储能SOC状态、充放电策略需在关联但分离的视图中呈现，通过交叉引用保持上下文关联
5. **非IT用户配置体验**：电站参数、储能参数、省份市场规则的配置需要引导式向导，降低非技术人员的认知门槛
6. **多电站上下文切换的认知负荷**：交易员同时管理多个电站（有储能/无储能），需在电站间快速切换同时保持全局状态感知
7. **AI犯错时刻的信任维护**：系统需诚实展示"交易员判断比AI更准"的案例，通过人工干预收益归因机制反向增强信任
8. **30秒加载状态的有意义设计**：96时段报价生成需<30秒，期间需展示Agent协作进度（实时推送），让用户"看着AI思考"

### Design Opportunities

1. **Agent决策链路可视化（核心竞争力）**：通过渐进式展开（Progressive Disclosure）设计Agent推理过程——默认看结论，展开看每个Agent的推理细节。30秒生成过程中实时展示Agent协作进度流（预测Agent完成→策略Agent计算中→储能Agent待启动），让"看着AI思考"成为信任建设和差异化的核心体验。架构层需区分"面向用户的可解释性"和"面向运维的可观测性"
2. **回测报告的数据叙事（演示路径核心）**：将回测分析页设计为极具说服力的数据叙事工具——用真实数字讲"AI多赚380万"的故事，兼具内部分析工具和面向决策者的产品演示器双重角色
3. **"一屏决策"交易工作台（操作路径保底）**：将功率预测、AI报价建议整合到协调视图中，MVP先确保核心流程跑通，后续迭代优化体验
4. **储能调度时间轴可视化**：甘特图/时间轴展示96时段充/放/待机状态，叠加电价曲线和功率预测，独立于报价工作台但通过交叉引用关联

### Key Design Decisions

1. **储能调度与报价呈现方式：关联但分离**——储能调度页和报价工作台为独立页面，通过交叉引用保持关联（报价时段详情链接到储能计划，储能时段标注关联报价策略），共享时间轴和视觉语言。每个角色在自己的"决策空间"操作，需要时一键跳转
2. **可解释AI为核心竞争力**——Agent决策链路可视化不仅是UX差异化，更是国资合规刚需。每个Agent的输出需预留面向用户的摘要字段，区别于面向开发者的原始日志

## Core User Experience

### Defining Experience

ElectricityTradingPlatform 有两个"定义性体验"，分别对应MVP的两条路径：

**定义性体验1：回测数据叙事时刻（演示路径）**
王总打开回测报告，3秒内看到"AI策略全年增收380万"，10秒内理解收益归因（日前报价优化210万 + 偏差考核减少170万 + 储能套利贡献），30秒内被说服。这个时刻决定了产品是否能获得试点部署的拍板——没有这个时刻的成功，后面的一切都不存在。

**定义性体验2：AI报价审核的信任时刻（操作路径）**
李娜展开Agent决策链路，看到"预测Agent判断出力偏低 + 电价预测处于高位 → 策略Agent建议报价上浮至385元/MWh → 储能Agent确认SOC充足 → 风控Agent审核通过"，理解AI为什么这样建议，决定是否同意。这个时刻是"可解释AI"核心竞争力的直接体现——让交易员从"被迫信任黑箱"变为"看懂后选择信任"。

### Platform Strategy

- **平台类型**：纯桌面Web应用（MVP无移动端，Phase 3考虑管理层移动看板）
- **部署模式**：本地/私有云部署（非公有云SaaS），不依赖CDN，前端资源需优化加载
- **交互方式**：鼠标 + 键盘操作为主
- **离线需求**：无离线需求，但需考虑数据新鲜度指示——电价数据超24小时未更新时在报价页面显著警告
- **浏览器兼容**：面向企业办公环境，需兼容主流浏览器（Chrome/Edge最新2个大版本），考虑国企可能使用的信创环境浏览器
- **屏幕适配**：主要适配1920×1080及以上分辨率（企业办公显示器标准），交易工作台和回测分析页需要大屏空间承载信息密度

### Effortless Interactions

以下交互必须做到"零思考、完全自然"：

1. **报价确认流程**：审核完毕后一键确认提交，不需要二次跳转或额外步骤
2. **电站切换**：管理多个电站时，切换上下文如同浏览器切换标签页——快速、无缝、保持全局状态感知
3. **Agent链路展开/折叠**：默认看结论，好奇时展开看每个Agent的推理细节，不需要导航到新页面——渐进式展开（Progressive Disclosure）
4. **负电价预警感知**：不需要逐时段检查，系统主动将负电价风险时段高亮推到面前，配有储能的电站同时展示储能充电建议
5. **回测报告导出**：一键生成PDF，不需要手动截图或排版，报告自动包含关键数据叙事和收益归因图表
6. **储能-报价交叉引用**：在报价工作台看到储能相关信息时，一键跳转到储能调度页对应时段；反之亦然
7. **数据异常处理**：数据导入后异常数据按类型分组展示，非技术人员可快速判断"这个异常要不要管"——常见异常（如节假日停市）提供一键"确认正常"

### Critical Success Moments

| 时刻 | 用户 | 成功感受 | 失败后果 |
|------|------|---------|---------|
| **回测数据叙事** | 王总 | "380万，清清楚楚" → 拍板试点 | 数据看不懂 → 不信任 → 不采购 |
| **首次AI报价审核** | 李娜 | "AI比我想的还细致" → 开始信任 | 建议离谱或无法解释 → 彻底不信AI |
| **Agent链路展开** | 李娜/赵磊 | "原来AI是这样想的" → 信任加深 + 合规可追溯 | 链路看不懂 → 可解释性形同虚设 |
| **人工覆盖后的收益归因** | 李娜 | "系统认可我的判断" → 人机协作正循环 | 看不到干预效果 → 不再认真审核 |
| **首次数据导入** | 老周 | "不需要IT就搞定了" → 交易团队自主权 | 导入报错无引导 → 必须找IT → 失去耐心 |
| **储能调度指令接收** | 陈工 | "指令清晰，设备安全" → 放心执行 | 指令不清或超限 → 拒绝执行 → 系统不被信任 |

### Experience Principles

1. **数据自己说话（Data Speaks）**：不用解释AI有多好，让回测数据和收益对比数字自己说服用户。从王总的"380万增收"到李娜的"这个时段多赚2,800元"，每个角色看到的都是具体的、可追溯的数字
2. **透明即信任（Transparency is Trust）**：Agent决策链路的可视化不是锦上添花，而是产品核心竞争力。每一个AI建议都可以展开看"为什么"，每一次人工干预都被记录和归因。国资合规需要它，信任建设需要它
3. **角色即视角（Role is View）**：同一份数据，交易员看操作面板、主管看管理看板、高管看一页纸汇报、运维看设备指令。不是权限裁剪，而是按角色心智模型重新组织信息
4. **AI辅助、人做决策（AI Assists, Human Decides）**：系统永远不会自动提交交易。AI完成分析后暂停等待人工审核，交易员拥有最终决策权。当AI犯错时，系统诚实展示人工干预的价值
5. **关联但不干扰（Connected but Not Cluttered）**：储能调度与报价策略、功率预测与电价预测——相关信息通过交叉引用关联，但各自保持独立的决策空间，避免信息过载

## Desired Emotional Response

### Primary Emotional Goals

| 用户角色 | 核心情感 | 情感描述 |
|---------|---------|---------|
| **王总（管理层）** | 确信感（Conviction） | "这个数据是实在的、可信的，我可以拿这个向集团汇报" |
| **李娜（交易员）** | 掌控感（In Control） | "AI不是在替代我，而是给我超能力——我理解它、可以覆盖它、能看到自己的价值" |
| **赵磊（交易主管）** | 安心感（Reassurance） | "团队表现有据可查，收益归因清清楚楚，我可以自信地向上汇报" |
| **老周（配置员）** | 胜任感（Competence） | "我能搞定这个，不需要找IT" |
| **陈工（储能运维）** | 可靠感（Reliability） | "指令清晰、设备安全约束被严格遵守，我可以放心执行" |

### Emotional Journey Mapping

| 阶段 | 期望情感 | 需要避免的情感 |
|------|---------|-------------|
| **首次接触（演示/回测）** | 惊讶→确信："原来AI真的能多赚这么多" | 怀疑："这数据是不是编的" |
| **日常操作（报价审核）** | 掌控→高效："AI帮我想到了我没注意的" | 焦虑："AI会不会坑我" |
| **AI犯错时** | 被认可→信任："系统承认我比AI判断更准" | 挫败："AI不靠谱，不想用了" |
| **出错/异常时** | 从容→引导："系统告诉我该怎么处理" | 恐慌："出问题了我不知道怎么办" |
| **月度汇报时** | 自信→专业："数据报告拿得出手" | 尴尬："数据口径对不上，解释不清" |

### Micro-Emotions

对本产品最关键的四组微情感对比：

1. **信任 vs 怀疑**：最核心的情感轴。可解释AI的全部UX设计都服务于把用户从怀疑推向信任——Agent决策链路可视化、人工干预收益归因、AI vs 人工对比数据
2. **掌控 vs 被替代**：交易员必须感到AI是辅助而非替代。"人做决策"的体验原则在情感层面的体现——永远不自动提交、覆盖操作被尊重和记录、干预价值被量化展示
3. **确信 vs 困惑**：数据呈现必须让人3秒内抓住重点，而非淹没在数字里。回测报告的"数据叙事"设计直接服务于这个情感目标
4. **从容 vs 恐慌**：系统异常、AI降级、数据过期等场景，用户应该感到"系统在掌控局面"——降级模式有清晰提示、数据新鲜度有显著标识、异常处理有引导路径

### Design Implications

| 情感目标 | UX设计策略 |
|---------|----------|
| **确信感** | 回测报告使用大字号核心数字+收益归因瀑布图，3秒内传达关键结论；所有数据可下钻到时段级明细，支撑"数据是真实的"感受 |
| **掌控感** | AI建议始终标注"建议"而非"指令"；微调操作即时响应；覆盖理由记录界面简洁不打断流程；干预收益归因在次日自动计算并展示 |
| **安心感** | 收益看板默认展示"一切正常"的全局状态；异常指标用颜色梯度（而非弹窗）温和提醒；交易员绩效对比用中性语言避免"排名羞辱" |
| **胜任感** | 配置向导用步骤进度条+预估剩余时间；每步有"这是什么"的上下文解释；错误提示用"建议操作"而非技术错误码 |
| **可靠感** | 储能调度指令用结构化卡片展示（时间/功率/方向/SOC变化），无歧义；超限指令自动拦截并解释原因；设备异常反馈有明确的操作路径 |
| **信任建设** | Agent协作进度实时流让"等待"变为"观察AI思考"；Agent链路展开使用自然语言摘要而非技术日志；"AI vs 人工"对比数据每日自动生成 |
| **从容应对异常** | AI降级模式用信息横幅（而非阻断弹窗）提示；数据过期用时间戳+颜色标识而非强制阻断操作；系统状态页汇总所有异常并按优先级排列 |

### Emotional Design Principles

1. **专业感优先于炫酷感**：这是国资企业的专业工具，不是消费级应用。视觉设计追求"稳重、专业、数据驱动"，避免花哨动效和过度装饰。用户需要的是"这个工具靠谱"，而非"这个工具好酷"
2. **温和引导而非强制打断**：异常和警告使用信息横幅、颜色标识、徽章等温和方式提醒，而非弹窗和阻断。让用户保持操作流畅性的同时感知重要信息
3. **诚实的AI**：当AI不确定时展示置信度、当AI犯错时诚实归因、当系统降级时明确告知。诚实的系统比永远"正确"的系统更容易获得信任
4. **尊重专业经验**：交易员和运维员都是领域专家。系统不应表现得"比人聪明"，而是展示"我做了这些分析供你参考"。人工覆盖操作不应有"你确定要覆盖AI建议吗？"的质疑语气
5. **渐进式复杂度**：首次使用时展示最简视图，随着用户熟悉度提升逐步解锁更深层信息（Agent链路详情、因子权重分析等）。不在第一天就用全部复杂性吓退用户

## UX Pattern Analysis & Inspiration

### Inspiring Products Analysis

#### 1. Bloomberg Terminal / 同花顺 — 金融交易终端

**核心借鉴：** 高信息密度场景下的专业交易界面设计

**做得好的地方：**
- 多面板布局：在单屏上同时展示行情、K线、订单簿、持仓等多维信息，交易员无需切换即可获取决策所需的全部上下文
- 颜色语义系统：红绿涨跌、黄色预警、蓝色信息——用户不需要读文字就能感知数据状态
- 键盘快捷操作：专业用户可以通过键盘快速完成高频操作，减少鼠标依赖
- 数据密度分层：概览→详情→明细的三级钻取，用户自主控制信息深度

**对本项目的启示：**
- 交易工作台可参考多面板布局思路——左侧电站列表 + 中央96时段报价面板 + 右侧Agent推理摘要
- 颜色语义系统：负电价时段用红色/橙色预警、正常时段用蓝色/绿色、储能充电用特定颜色、放电用另一颜色
- 但要注意：Bloomberg面向的是专业金融交易员（极高技术水平），我们的用户技术水平"中等"，信息密度需要比Bloomberg更克制

#### 2. Claude / ChatGPT — AI推理过程展示

**核心借鉴：** AI思考过程的渐进式透明展示

**做得好的地方：**
- Claude的Extended Thinking：折叠的思考过程，用户可选择性展开查看AI推理细节
- 流式输出（Streaming）：结果逐步呈现而非等待全部完成，降低等待焦虑
- 自然语言解释：AI用人类可理解的语言解释自己的推理过程，而非技术日志
- 置信度隐性传达：用"我认为"、"很可能"等语气词传达不确定性

**对本项目的启示：**
- Agent决策链路可视化直接借鉴"折叠思考过程"模式——默认折叠显示结论，展开显示每个Agent的推理过程
- 30秒报价生成期间，借鉴流式输出的实时感——逐步展示"预测Agent完成✓ → 策略Agent计算中... → 储能Agent待启动"
- Agent输出用自然语言摘要（"预测Agent判断明日时段32-36风速下降，出力预计降低15%"），而非JSON或技术格式
- 置信度用直觉化表达（高/中/低 + 颜色标识），而非数字概率

#### 3. Grafana / Datadog — 运维监控与数据可视化

**核心借鉴：** 时序数据可视化、告警体系和仪表盘设计

**做得好的地方：**
- 时序图表：大量时间序列数据的高效可视化，支持缩放、平移、时间范围选择
- 告警分级：Critical/Warning/Info三级告警，不同严重程度用不同颜色和通知方式
- 仪表盘组合：多个图表组件灵活组合成仪表盘，不同角色可看不同仪表盘
- 数据新鲜度指示：每个面板显示数据最后更新时间，过期数据有明确警告

**对本项目的启示：**
- 96时段功率预测/电价预测曲线直接借鉴时序图表模式，支持时段范围选择和缩放查看
- 收益看板可参考仪表盘组合模式——交易主管和高管看到不同的仪表盘组合
- 数据新鲜度指示直接适用——电价数据超24小时未更新在对应面板显示警告
- 告警分级思路：负电价预警=Critical（红色）、偏差超标=Warning（橙色）、AI降级=Info（蓝色横幅）
- 储能SOC状态可参考Grafana的Gauge面板——仪表盘式展示当前SOC百分比和安全范围

#### 4. 飞书 / Notion — 企业工具的引导式体验

**核心借鉴：** 非技术用户的上手引导和配置体验

**做得好的地方：**
- 引导式向导：首次使用时分步引导，每步有明确进度指示
- 模板系统：提供预设模板降低从零配置的认知负担
- 上下文帮助：鼠标悬停即显示字段解释，不需要查阅文档
- 错误恢复友好：操作失误可撤回，导入数据可重试，不会"一步错步步错"

**对本项目的启示：**
- 老周的系统配置向导直接借鉴引导式向导模式——步骤进度条 + 每步说明 + 预估时间
- 储能参数配置借鉴模板系统——提供"磷酸铁锂-2小时储能"等标准模板，用户选择后仅需微调
- 省份市场规则配置借鉴模板——"山东省2025规则"等预设模板
- 数据导入借鉴错误恢复思路——导入失败可断点续传，异常数据可逐条修正而非全部重来

### Transferable UX Patterns

#### 导航模式

| 模式 | 来源 | 适用场景 |
|------|------|---------|
| **侧边栏+主面板+详情面板** | Bloomberg | 交易工作台：左侧电站列表 + 中央96时段面板 + 右侧Agent摘要 |
| **仪表盘组合** | Grafana | 收益看板：按角色展示不同仪表盘组合（主管视图 vs 高管视图） |
| **标签页切换** | 浏览器 | 多电站快速切换：每个电站一个标签，保持各自状态 |

#### 交互模式

| 模式 | 来源 | 适用场景 |
|------|------|---------|
| **渐进式展开** | Claude Thinking | Agent决策链路：默认折叠结论，展开看推理细节 |
| **流式进度** | ChatGPT Streaming | 30秒报价生成期间的Agent协作实时进度流 |
| **时序图表缩放** | Grafana | 96时段功率预测/电价预测曲线的时段范围选择 |
| **引导式向导** | 飞书/Notion | 系统配置：步骤进度条 + 说明 + 模板选择 |
| **批量操作+单项微调** | Excel | 96时段报价：全局确认 + 单时段微调 |

#### 视觉模式

| 模式 | 来源 | 适用场景 |
|------|------|---------|
| **颜色语义系统** | Bloomberg | 负电价红色/正常蓝色/储能充电绿色/放电橙色 |
| **数据卡片+大字号KPI** | Grafana Stat Panel | 回测报告核心数字："+380万"大字号突出 |
| **仪表盘Gauge** | Grafana | 储能SOC状态展示：当前百分比+安全范围 |
| **告警横幅** | Datadog | AI降级提示、数据过期警告 |
| **瀑布图** | 财务报表 | 收益归因分解：日前报价+偏差优化+储能套利各贡献多少 |

### Anti-Patterns to Avoid

1. **Bloomberg式的全面复杂性**：Bloomberg假设用户是专业金融交易员，可以承受极高信息密度。我们的用户（特别是王总、老周）技术水平"中等"或"低"，不能直接照搬Bloomberg的信息密度，必须更加克制，优先展示关键信息
2. **弹窗轰炸**：传统企业软件喜欢用模态弹窗提示一切——确认、警告、错误。这破坏操作流畅性，造成"恐慌感"。改用信息横幅、颜色标识、徽章等非阻断方式
3. **AI黑箱呈现**：部分AI产品只展示结果不展示过程，用户无法判断AI建议是否可靠。这与我们的"可解释AI"核心竞争力直接冲突——必须让AI思考过程可见
4. **"你确定吗？"式的质疑**：当用户覆盖AI建议时，不应弹出"你确定要覆盖AI建议吗？"的质疑对话框。这传递了"AI比你聪明"的暗示，破坏掌控感和专业尊重
5. **数据表格地狱**：传统电力行业系统大量使用纯数据表格展示96时段数据。虽然表格数据密度高，但缺乏趋势感知和视觉模式识别。应用图表+表格结合，图表看趋势、表格看精确值
6. **配置即代码**：要求用户编辑配置文件或填写技术参数（如API端点、JSON格式）。老周是交易员不是工程师，所有配置都应有GUI向导

### Design Inspiration Strategy

**直接采用：**
- Claude的折叠思考过程 → Agent决策链路的渐进式展开
- Grafana的时序图表+Gauge面板 → 96时段曲线展示 + 储能SOC仪表
- 飞书的引导式向导 → 系统配置体验
- Grafana的告警分级+数据新鲜度 → 负电价预警 + 数据过期提示

**改造适配：**
- Bloomberg的多面板布局 → 简化版三栏布局（降低信息密度，适配中等技术水平用户）
- ChatGPT的流式输出 → Agent协作进度实时流（从文字流式变为步骤进度条+状态标签）
- 财务报表的瀑布图 → 收益归因分解可视化（适配电力交易领域的归因维度）

**坚决避免：**
- Bloomberg级信息密度 → 改为分层展示、按需展开
- 传统企业软件的弹窗轰炸 → 改为非阻断式温和提醒
- AI黑箱呈现 → 坚持Agent链路透明化（核心竞争力）
- 质疑式确认对话框 → 改为平等记录式操作（"请记录调整理由"而非"确定覆盖？"）

## Design System Foundation

### Design System Choice

**选定方案：Ant Design Vue + AntV G2Plot**

技术栈：Vue 3 + TypeScript + Ant Design Vue 4.x + AntV G2Plot

- **UI组件库**：Ant Design Vue — Vue 3生态中最成熟的企业级组件库，提供完整的表单、表格、布局、导航等基础组件
- **图表库**：AntV G2Plot — 与Ant Design同生态，API设计一致，开箱即用的统计图表（折线图、柱状图、瀑布图、仪表盘等）
- **辅助图表**：AntV G6（可选）— 用于Agent决策链路的DAG（有向无环图）可视化
- **图标系统**：@ant-design/icons-vue — 统一图标风格

### Rationale for Selection

1. **国产软件审计合规**：必须使用Vue框架（React存在国产软件审计风险）。Ant Design Vue是Vue生态中最成熟的企业级UI库，社区活跃、文档完善、中文原生支持
2. **开发效率**：Ant Design Vue提供50+开箱即用的高质量组件（ProTable、ProForm、ProLayout等），MVP 3个月时间线下可显著加速开发
3. **企业级审美契合**：Ant Design的设计语言——简洁、专业、数据驱动——与国资企业用户的审美期待（"稳重、专业"）高度吻合，避免消费级应用的花哨感
4. **中文原生支持**：Ant Design Vue的国际化(i18n)对中文场景零配置，DatePicker、Pagination等组件默认中文友好
5. **图表生态统一**：AntV G2Plot与Ant Design设计语言一致，主题色、字体、间距与UI组件视觉统一，无需额外适配
6. **ProComponents加速**：Ant Design Vue的ProComponents（高级表格、高级表单、高级布局）直接适用于96时段报价表格、系统配置向导、角色差异化布局等核心场景

### Implementation Approach

**组件分层策略：**

| 层级 | 描述 | 示例 |
|------|------|------|
| **L1 基础层** | 直接使用Ant Design Vue原生组件 | Button、Table、Form、Modal、Tabs、Menu |
| **L2 业务层** | 基于L1组合的通用业务组件 | DataCard（数据卡片）、StatusBadge（状态徽章）、TimeRangeSelector（时段选择器） |
| **L3 领域层** | 电力交易领域专用组件 | AgentChainViewer（Agent链路查看器）、Period96Grid（96时段网格）、SOCGauge（储能SOC仪表）、RevenueWaterfall（收益瀑布图）、PowerForecastChart（功率预测曲线）、PriceHeatmap（电价热力图） |

**6个核心L3自定义组件（MVP必需）：**

1. **AgentChainViewer** — Agent决策链路渐进式展开组件（核心竞争力组件）
2. **Period96Grid** — 96时段报价网格，支持批量确认+单时段微调+颜色语义
3. **SOCGauge** — 储能SOC状态仪表盘，显示当前电量百分比和安全范围
4. **RevenueWaterfall** — 收益归因瀑布图，分解日前报价/偏差优化/储能套利贡献
5. **PowerForecastChart** — 功率预测时序曲线，叠加实际出力对比
6. **PriceHeatmap** — 96时段电价热力图，突出负电价和高价时段

### Customization Strategy

**设计令牌（Design Tokens）定制：**

| 令牌类别 | 定制内容 |
|---------|---------|
| **主色调** | 深蓝色系（#1B3A5C）— 传达专业、稳重、能源行业属性 |
| **功能色** | 成功绿(#52C41A)、警告橙(#FA8C16)、错误红(#FF4D4F)、信息蓝(#1890FF) |
| **领域语义色** | 充电绿(#73D13D)、放电橙(#FFA940)、待机灰(#BFBFBF)、负电价红(#FF4D4F)、高价紫(#722ED1) |
| **字体策略** | 中文用系统默认（-apple-system, PingFang SC, Microsoft YaHei），数据用等宽字体（JetBrains Mono）确保96时段数字对齐 |
| **间距/密度** | 交易工作台和回测分析页使用紧凑模式（compact），配置页使用标准模式（default） |
| **圆角** | 较小圆角（4px）— 传达专业工具感，避免消费级应用的圆润风格 |
| **阴影** | 轻微阴影 — 区分层级但不花哨 |

**主题配置方式：** 通过Ant Design Vue 4.x的ConfigProvider + theme token覆盖实现全局主题定制，无需fork组件库源码，升级友好

## 2. Core User Experience

### 2.1 Defining Experience

ElectricityTradingPlatform 的核心体验是**双核心定义**：

**定义体验1："看着AI思考，然后你做决策"（操作路径核心）**

交易员李娜点击"生成报价建议"→ 步骤条实时展示Agent协作进度（预测Agent ✓ → 策略Agent计算中... → 储能Agent待启动 → 风控Agent待启动）→ 30秒后96时段报价建议生成完成 → 展开Agent决策链路查看"为什么这样建议" → 批量确认或单时段微调 → 一键提交。

这是可解释AI核心竞争力的直接体验——用户不是在使用一个黑箱工具，而是在与一个透明的AI助手协作决策。

**定义体验2："一页数据说服老板"（演示路径核心）**

王总打开回测报告 → 3秒内看到"+380万"大字号核心数字 → 10秒内通过瀑布图理解收益归因（日前报价优化+偏差考核减少+储能套利贡献）→ 30秒内被说服 → 一键导出PDF。

这是获得试点部署拍板的关键体验——没有这个时刻的成功，后面的一切都不存在。

### 2.2 User Mental Model

**交易员（李娜）当前工作模式：**

- 当前完全手工操作：交易员根据经验和历史数据，逐时段手工填写96个报价
- 工作量大、重复性高，早上7:30-9:00窗口期压力极大
- 没有AI辅助工具，全凭个人经验和简单的Excel分析
- 对负电价时段的判断依赖经验，容易遗漏

**用户带来的心智模型：**

| 用户 | 心智模型 | 设计含义 |
|------|---------|---------|
| 李娜 | "AI是一个新来的助手，我要检查它的工作" | AI建议必须以"供审核"的姿态呈现，而非"待执行的指令" |
| 王总 | "给我看证据，用数据说话" | 回测报告必须像财务报表一样严谨、可追溯 |
| 赵磊 | "我需要知道团队和AI各自的贡献" | 收益归因必须区分AI策略贡献和人工干预贡献 |
| 老周 | "配置应该像填表格，不是写代码" | 配置向导用表单UI，不暴露任何技术细节 |
| 陈工 | "给我明确的充放电指令，别让我猜" | 调度指令用结构化卡片，时间/功率/方向/SOC变化一目了然 |

**从手工到AI辅助的转变路径：**

手工逐时段填报价 → AI生成96时段建议（用户审核确认）→ 用户逐渐信任后只关注AI标记的"需关注"时段 → 最终形成"AI做初稿、人做终审"的高效协作模式

### 2.3 Success Criteria

**核心体验成功指标：**

| 成功指标 | 度量标准 | 用户感受 |
|---------|---------|---------|
| **报价生成速度** | 96时段建议 ≤30秒完成 | "比我手工快太多了" |
| **Agent进度可感知** | 步骤条实时更新，用户始终知道进行到哪一步 | "我能看到AI在干什么，不是干等" |
| **决策链路可理解** | 展开Agent链路后，用自然语言摘要解释每个Agent的推理 | "原来AI是这样想的，有道理" |
| **审核效率** | 从AI建议生成到交易员确认提交 ≤15分钟（vs 当前手工1-2小时） | "省了大量重复工作" |
| **微调便捷** | 单时段修改即时生效，无需重新生成全部 | "我改了几个时段就搞定了" |
| **回测说服力** | 王总30秒内理解核心收益数字 | "380万，清清楚楚" |
| **覆盖理由可选** | 覆盖AI建议时可选择填写理由，不强制 | "系统尊重我的判断，不质疑我" |

### 2.4 Novel UX Patterns

**创新模式（需要设计教育用户）：**

1. **Agent协作步骤条**：用Ant Design Vue Steps组件展示多Agent协作进度，这是本产品独创的交互模式
   - 熟悉的隐喻：类似"外卖订单进度"——下单→商家接单→骑手取餐→配送中→已送达
   - 用户教育：首次使用时用Tooltip解释"这是AI的5位专家在协作分析"
   - 每步显示：Agent名称 + 当前状态（等待/计算中/已完成）+ 耗时

2. **渐进式Agent决策链路**：默认折叠显示结论，用户可逐层展开查看推理过程
   - 熟悉的隐喻：类似"手风琴/折叠面板"——标题是结论，展开是细节
   - L1 结论层：Agent名称 + 一句话结论（如"预测Agent：明日出力预计下降15%"）
   - L2 推理层：展开后显示关键因子和推理逻辑（如"风速下降→出力降低→建议报价上浮"）

**成熟模式（可直接采用）：**

1. **96时段网格**：类似Excel的网格操作，交易员天然熟悉表格操作模式
2. **仪表盘/数据卡片**：类似Grafana的KPI展示，管理层熟悉的数据呈现
3. **配置向导**：类似飞书的分步引导，非技术用户友好
4. **瀑布图**：财务报表中的标准图表，管理层天然理解

### 2.5 Experience Mechanics

#### 核心体验1：AI报价审核流程

**1. Initiation（启动）**
- 触发方式：交易员李娜在交易工作台选择电站+交易日期后，点击"生成AI报价建议"按钮
- 前置条件：系统已有该电站的功率预测数据和电价数据（数据新鲜度检查通过）
- 若数据未就绪：按钮置灰 + Tooltip提示"等待xx数据更新"

**2. Interaction（交互 — 30秒等待期）**
- 步骤条展示Agent协作进度（Ant Design Vue Steps组件）：
  - Step 1：功率预测Agent — 分析气象数据和历史出力
  - Step 2：电价预测Agent — 分析市场供需和历史电价
  - Step 3：报价策略Agent — 综合预测结果生成96时段报价
  - Step 4：储能调度Agent — 优化充放电计划（仅有储能电站）
  - Step 5：风控审计Agent — 检查合规性和风险控制
- 每步完成时状态标签从"计算中..."变为"✓ 已完成（耗时3.2s）"
- 步骤条下方可选展示当前Agent的实时简要输出

**3. Feedback（反馈 — 结果呈现）**
- 报价建议生成完成：96时段报价网格（Period96Grid）铺满中央面板
- 颜色语义：正常时段蓝色、需关注时段橙色标记、负电价时段红色高亮
- 右侧面板显示Agent决策链路摘要（AgentChainViewer），默认折叠
- 顶部汇总卡片：预估收益、vs 上一交易日、关注时段数量
- 用户操作：
  - 批量确认：全部时段满意 → 点击"确认全部"
  - 单时段微调：点击某时段 → 直接修改报价数字 → 可选填写调整理由
  - 展开Agent链路：点击右侧面板的Agent名称 → 查看该Agent的推理摘要

**4. Completion（完成）**
- 确认提交后：页面顶部出现成功信息横幅"报价已提交，共96时段，其中X个时段经人工调整"
- 人工调整记录自动保存，次日可查看干预收益归因
- 自动跳转到下一个待处理电站（若有多电站）或回到工作台概览

#### 核心体验2：回测数据叙事

**1. Initiation（启动）**
- 触发方式：王总/赵磊点击导航栏"回测分析"进入回测报告页
- 默认展示最近一次完整回测结果

**2. Interaction（交互）**
- 首屏：大字号核心KPI卡片 — "+380万"年度增收、收益率提升百分比
- 第二屏：收益归因瀑布图（RevenueWaterfall）— 日前报价优化 + 偏差考核减少 + 储能套利贡献
- 第三屏：月度趋势对比折线图 — AI策略 vs 原有策略的逐月收益对比
- 可下钻：点击任意月份 → 展开到日级数据 → 再展开到时段级明细

**3. Feedback（反馈）**
- 数据加载完成的视觉确认：数字从0动画过渡到最终值
- 下钻时面包屑导航保持位置感知
- 数据来源标注："基于2024.1-2024.12历史数据回测"

**4. Completion（完成）**
- 一键导出PDF：生成包含核心数据叙事和图表的可打印报告
- 报告自动包含：执行摘要 + 收益归因 + 月度趋势 + 关键发现

## Visual Design Foundation

### Color System

**色彩体系基于Ant Design Vue主题定制，沿用Step 6设计令牌并扩展：**

**主色阶梯度（Primary）：**

| 色阶 | 色值 | 用途 |
|------|------|------|
| primary-1 | #E8EFF7 | 选中行背景、轻量高亮 |
| primary-2 | #C5D6EA | hover状态背景 |
| primary-3 | #8BAFD4 | 次要边框、分割线 |
| primary-5 | #3D6F9E | 活跃标签、链接色 |
| primary-6 | #1B3A5C | **主色调** — 导航栏、主按钮、标题强调 |
| primary-7 | #142D47 | 按钮hover/pressed状态 |
| primary-9 | #0A1929 | 深色背景（仅用于侧边栏） |

**功能色（Functional Colors）：**

| 类别 | 色值 | 场景 |
|------|------|------|
| 成功/正向 | #52C41A | 操作成功、收益增长、Agent完成 |
| 警告 | #FA8C16 | 需关注时段、偏差接近阈值 |
| 错误/危险 | #FF4D4F | 负电价时段、操作失败、超限预警 |
| 信息/中性 | #1890FF | 提示信息、链接、Agent计算中 |

**领域语义色（Domain Semantic Colors）：**

| 语义 | 色值 | 场景 |
|------|------|------|
| 储能充电 | #73D13D 绿色 | 充电时段标记、充电功率曲线 |
| 储能放电 | #FFA940 橙色 | 放电时段标记、放电功率曲线 |
| 储能待机 | #BFBFBF 灰色 | 待机时段标记 |
| 负电价 | #FF4D4F 红色 | 负电价时段高亮、预警标记 |
| 高价时段 | #722ED1 紫色 | 高价时段标记、套利窗口 |
| AI建议 | #1890FF 蓝色 | AI原始建议值 |
| 人工调整 | #FA8C16 橙色 | 经人工微调的时段标记 |
| 报量曲线 | #1B3A5C 深蓝 | 申报电量折线 |
| 报价曲线 | #722ED1 紫色 | 申报价格折线 |

**对比度要求：** 所有文字与背景色组合满足WCAG 2.1 AA标准（正文≥4.5:1，大字号≥3:1）

### Typography System

**字体栈：**

| 类别 | 字体 | 用途 |
|------|------|------|
| **中文正文** | -apple-system, PingFang SC, Microsoft YaHei, sans-serif | 所有中文文本 |
| **数据/数字** | JetBrains Mono, Consolas, monospace | 96时段报量报价数字、KPI大数字、SOC百分比 |

**字号层级（Type Scale）：**

| 层级 | 字号 | 行高 | 字重 | 用途 |
|------|------|------|------|------|
| Display | 36px | 44px | 600 | 回测报告核心KPI（"+380万"） |
| H1 | 24px | 32px | 600 | 页面标题 |
| H2 | 20px | 28px | 600 | 区域标题、卡片标题 |
| H3 | 16px | 24px | 600 | 小节标题、Agent名称 |
| Body | 14px | 22px | 400 | 正文、Agent推理摘要 |
| Body-sm | 13px | 20px | 400 | 紧凑模式正文、表格内文字 |
| Data | 13px(mono) | 20px | 500 | 96时段网格中的报量报价数字 |
| Caption | 12px | 18px | 400 | 辅助说明、时间戳、数据来源标注 |
| Tag | 12px | 16px | 500 | 状态标签、Agent状态标签 |

### Spacing & Layout Foundation

**基准网格：8px**

所有间距使用8px倍数：8px / 16px / 24px / 32px / 48px / 64px

**密度模式：**

| 模式 | 适用页面 | 组件间距 | 表格行高 | 卡片内边距 |
|------|---------|---------|---------|-----------|
| **紧凑模式（Compact）** | 交易工作台、储能调度页、96时段网格 | 8px | 36px | 12px |
| **标准模式（Default）** | 回测报告、收益看板、配置页 | 16px | 48px | 16px-24px |

**栅格系统：**

- 基于Ant Design Vue的24栏栅格
- 主布局：侧边栏（固定240px）+ 主内容区（自适应）
- 交易工作台三栏布局：左侧电站列表（240px固定）+ 中央报量报价面板（自适应）+ 右侧Agent摘要（320px可收起）
- 回测报告：单栏满宽布局，内容区最大宽度1400px居中
- 最小支持分辨率：1920×1080

**布局原则：**

1. **信息密度分场景**：交易工作台追求紧凑高效（借鉴Bloomberg但更克制），回测报告追求视觉叙事（借鉴Grafana仪表盘）
2. **固定+弹性混合**：侧边栏和Agent面板固定宽度保证一致性，主内容区弹性适配屏幕
3. **垂直滚动优先**：避免水平滚动，96时段网格通过合理列宽在1920px屏幕内完整展示

### Accessibility Considerations

**色彩无障碍：**
- 不仅靠颜色传达信息：负电价时段同时用红色+图标+文字标签三重标识
- 充电/放电/待机状态同时用颜色+方向箭头图标区分
- 人工调整时段用颜色+编辑图标双重标识

**交互无障碍：**
- 所有可操作元素支持键盘Tab导航
- 96时段网格支持方向键导航（上下左右移动单元格焦点）
- 关键操作（确认提交、覆盖AI建议）有明确的focus样式
- Agent步骤条进度变化通过aria-live区域通知屏幕阅读器

**字号无障碍：**
- 正文最小字号不低于12px
- 数据展示字号不低于13px
- 高管视图（回测报告）核心数字使用36px确保远距离可读

## Design Direction Decision

### Design Directions Explored

通过HTML交互式mockup（`ux-design-directions.html`）探索了4个设计方向：

| 方向 | 布局类型 | 适用场景 | 核心特征 |
|------|---------|---------|---------|
| **方向A：经典三栏工作台** | 侧边栏+中央网格+右侧Agent面板 | 交易工作台 | Agent链路始终可见，三栏一屏决策，信息密度较高 |
| **方向B：中央聚焦式** | 极简图标导航+最大化中央区域+Agent抽屉 | 交易工作台 | 报量报价网格获得最大宽度，Agent链路按需展开 |
| **方向C：仪表盘式** | 卡片化多面板平铺 | 交易工作台/收益看板 | 全局态势感知最强，曲线+SOC+网格+Agent一目了然 |
| **方向D：叙事式回测** | 纵向滚动数据叙事 | 回测报告 | 大字号KPI→瀑布图归因→月度趋势，数据叙事力最强 |

### Chosen Direction

**组合方案：按场景选用最优方向**

| 页面/场景 | 选用方向 | 理由 |
|----------|---------|------|
| **交易工作台** | 方向A（经典三栏） | Agent链路始终可见是核心竞争力的直接体现；三栏布局最匹配交易员"选电站→看建议→审核确认"的操作流程；借鉴方向B的顶部图表缩略区作为态势感知条 |
| **回测分析报告** | 方向D（叙事式） | 大字号KPI+瀑布图归因的叙事结构是说服管理层的最佳方式；纵向滚动符合报告阅读习惯；一键导出PDF友好 |
| **收益看板**（主管/高管） | 借鉴方向C（仪表盘式） | 卡片化布局适合监控和管理场景；可按角色重组仪表盘组合 |
| **储能调度页** | 方向A变体（三栏） | 左侧储能设备列表+中央96时段充放电时间轴+右侧SOC状态和Agent摘要 |
| **系统配置页** | 标准单栏布局 | 配置向导不需要复杂布局，步骤进度条+表单即可 |

### Design Rationale

1. **核心竞争力可见性优先**：选择方向A作为交易工作台基础，因为Agent决策链路的"始终可见"直接体现了可解释AI的差异化优势。方向B的抽屉式虽然给了更大网格空间，但将核心竞争力"藏"在了需要额外点击才能看到的位置
2. **按场景适配布局**：不同页面服务不同目标——操作页面追求效率（三栏紧凑），报告页面追求说服力（叙事式），监控页面追求全局感知（仪表盘式）
3. **信息密度适度克制**：方向A比Bloomberg更克制，通过Agent链路的渐进式展开（折叠/展开）控制信息密度，而非一次性铺满
4. **报量报价双列展示**：96时段网格需同时展示报量（MW）和报价（¥/MWh）两列核心数据，三栏布局的中央面板宽度在1920px分辨率下可容纳完整的8列数据（时段+时间+预测出力+报量+电价预测+报价+储能+状态）

### Implementation Approach

**页面布局映射：**

| 页面 | 布局方案 | Ant Design Vue组件 |
|------|---------|-------------------|
| 交易工作台 | 三栏：Sider(240px) + Content(flex) + Sider(320px,collapsible) | a-layout + a-layout-sider |
| 储能调度 | 三栏变体：Sider(240px) + Content(flex) + Sider(280px) | a-layout + a-layout-sider |
| 回测分析 | 单栏叙事：深色Hero区 + 白色内容区(max-width:1000px) | 自定义布局 |
| 收益看板 | 仪表盘：Grid卡片布局 | a-row + a-col + a-card |
| 系统配置 | 单栏向导：Steps进度条 + Form | a-steps + a-form |

**交互细节：**
- 交易工作台右侧Agent面板支持收起/展开（Sider collapsible），收起后显示为图标栏
- 回测报告首屏Hero区使用深蓝渐变背景（primary-9 → primary-6），与侧边栏视觉呼应
- 收益看板卡片支持拖拽排序（Phase 2，MVP固定布局）

## User Journey Flows

### 旅程流程1：日前报价审核流程（交易员李娜）

**核心路径：** 批量概览 → 单站详审/批量确认 → 提交 → 储能引导

```mermaid
flowchart TD
    A[李娜登录平台] --> B[交易工作台 — 批量概览视图]
    B --> B1{检查数据就绪状态}
    B1 -->|全部就绪| B2[5个电站卡片列表<br/>每站显示：状态/预测出力/AI建议完成度]
    B1 -->|部分未就绪| B3[未就绪电站灰色标识<br/>Tooltip提示缺失数据类型<br/>已就绪电站可先处理]

    B2 --> C{选择处理方式}
    C -->|逐站审核| D[点击单个电站卡片<br/>进入单站详审视图]
    C -->|批量快速确认| E[批量视图：5站报价摘要并列<br/>仅显示需关注时段]

    D --> D1[三栏布局展开<br/>左：时段列表 中：96时段网格 右：Agent链路]
    D1 --> D2[审核AI报价建议]
    D2 --> D3{是否需要调整？}
    D3 -->|满意| D4[点击"确认本站报价"]
    D3 -->|需微调| D5[点击时段 → 修改报价<br/>可选填写调整理由]
    D5 --> D6[修改即时生效<br/>人工调整时段橙色标记]
    D6 --> D2

    D4 --> F{还有未审核电站？}
    F -->|有| F1[自动切换下一电站<br/>顶部进度条更新 3/5]
    F1 --> D1
    F -->|全部完成| G[批量提交确认页]

    E --> E1[查看5站需关注时段汇总<br/>负电价/低置信度/异常时段]
    E1 --> E2{是否需要深入某站？}
    E2 -->|是| D[切换到单站详审]
    E2 -->|否，批量确认| G

    G --> G1[汇总信息：5站共480时段<br/>其中X个时段经人工调整<br/>预估总收益¥XX万]
    G1 --> G2[点击"提交全部报价"]
    G2 --> G3[成功横幅：报价已提交]

    G3 --> H{有电站配置了储能？}
    H -->|有| H1[引导卡片：<br/>"A站、C站有储能调度计划待审核<br/>→ 去审核储能计划"]
    H -->|无| I[回到工作台概览]
    H1 --> H2{用户选择}
    H2 -->|去审核| J[跳转储能调度页]
    H2 -->|稍后处理| I
```

**关键设计点：**

- **批量概览为默认入口**：李娜打开工作台先看5个电站的整体状态，而非直接进入某个电站
- **逐站审核 vs 批量快速确认两条路径**：信任AI初期走逐站审核，熟悉后走批量确认（只看需关注时段）
- **自动切换下一站**：确认一站后自动切换，减少导航操作，顶部进度条（3/5）保持全局感知
- **报价→储能串联引导**：提交报价后，系统检测到有储能电站时，弹出引导卡片（非阻断式），用户可选择立即去审核或稍后处理

**错误恢复路径：**
- 数据未就绪 → 灰色电站+Tooltip，可先处理已就绪电站
- 提交失败 → 错误横幅+重试按钮，已填数据不丢失
- 误操作微调 → 支持"恢复AI建议"按钮（单时段级别）

### 旅程流程2：回测分析与报告导出（赵磊/王总）

**核心路径：** 参数选择 → 首屏KPI冲击 → 归因下钻 → 专题分析 → 导出

```mermaid
flowchart TD
    A[点击导航栏"回测分析"] --> B[参数选择]
    B --> B1[选择时间范围：近1月/近6月/全年/自定义]
    B --> B2[选择电站范围：全部/单站/分组]
    B --> B3[选择对比基准：历史实际/固定价格/行业均值]

    B1 & B2 & B3 --> C[加载回测数据<br/>加载动画：数据分析中...]

    C --> D[首屏Hero区 — 深蓝渐变背景]
    D --> D1[大字号KPI卡片<br/>"+380万" 年度AI增收<br/>数字从0动画过渡到终值]
    D --> D2[副指标卡片行<br/>收益率提升% / 偏差降低% / 储能贡献%]

    D1 & D2 --> E[第二屏 — 收益归因瀑布图]
    E --> E1[RevenueWaterfall组件<br/>日前报价优化 210万<br/>+ 偏差考核减少 170万<br/>+ 储能套利贡献 XX万<br/>= 总增收 380万]

    E1 --> F[第三屏 — 月度趋势对比]
    F --> F1[折线图：AI策略 vs 原策略<br/>逐月收益对比]
    F --> F2[储能贡献柱状图<br/>有储能vs无储能电站对比]

    F1 & F2 --> G{用户操作}
    G -->|下钻| G1[点击某月 → 展开日级数据]
    G1 --> G2[点击某日 → 展开时段级明细<br/>面包屑导航：全年 > 3月 > 3月15日]
    G -->|专题| G3[切换Tab：负电价专题分析]
    G3 --> G4[负电价时段统计<br/>AI避损金额/储能充电策略效果]
    G -->|导出| H[点击"导出PDF"]

    H --> H1[PDF预览弹窗<br/>自动包含：执行摘要+归因瀑布图<br/>+月度趋势+关键发现]
    H1 --> H2{确认导出？}
    H2 -->|确认| H3[生成PDF下载<br/>成功提示横幅]
    H2 -->|调整| H4[勾选/取消报告章节<br/>调整时间范围]
    H4 --> H1

    G2 --> G[返回继续操作]
    G4 --> G[返回继续操作]
```

**关键设计点：**

- **叙事式纵向滚动**：首屏大字号KPI → 瀑布图归因 → 月度趋势，符合汇报阅读习惯
- **3秒内传达核心结论**："+380万"数字动画过渡，视觉冲击力优先
- **三级下钻**：全年→月→日→时段，面包屑保持位置感知
- **PDF导出可定制**：自动生成完整报告，允许调整包含的章节

### 旅程流程3：系统初始化配置（老周）

**核心路径：** 4步向导 → 电站配置 → 市场规则 → 数据导入 → 确认启动

```mermaid
flowchart TD
    A[老周进入系统配置页] --> B[配置向导首页<br/>步骤进度条：4步<br/>预估总时间：约2小时]

    B --> S1[Step 1/4：电站参数配置]
    S1 --> S1a[添加电站表单<br/>电站名称/装机容量/并网点/类型<br/>每字段有"这是什么"提示]
    S1a --> S1b{该电站有储能？}
    S1b -->|有| S1c[储能参数配置<br/>选择模板："磷酸铁锂-2小时储能"<br/>自动填充默认值<br/>老周仅需微调SOC上下限等]
    S1b -->|无| S1d[跳过储能配置]
    S1c & S1d --> S1e{还有电站要添加？}
    S1e -->|有| S1a
    S1e -->|全部添加完| S1f[电站列表汇总确认<br/>5个电站，其中2个配储能]
    S1f --> S2

    S2[Step 2/4：市场规则配置] --> S2a[选择省份模板<br/>"山东省2025规则"]
    S2a --> S2b[自动填充限价范围/结算方式<br/>偏差考核公式]
    S2b --> S2c[老周确认或微调参数]
    S2c --> S3

    S3[Step 3/4：数据导入] --> S3a[上传历史交易数据<br/>支持Excel/CSV<br/>拖拽或点击上传]
    S3a --> S3b[上传储能历史运行数据<br/>仅针对配储能的电站]
    S3b --> S3c[数据解析进度条]
    S3c --> S3d{数据质量校验}
    S3d -->|全部通过| S4
    S3d -->|有异常| S3e[异常数据按类型分组展示<br/>节假日停市 18条 → 一键"确认正常"<br/>格式问题 5条 → 逐条修正引导]
    S3e --> S3f[修正后重新校验]
    S3f --> S3g[数据完整性：99.2%<br/>状态：可用于回测 ✓]
    S3g --> S4

    S4[Step 4/4：确认与启动] --> S4a[配置汇总页<br/>5个电站/2个储能/山东规则<br/>数据完整性99.2%]
    S4a --> S4b[点击"完成配置并启动"]
    S4b --> S4c[预测模型开始运行<br/>回测任务启动<br/>成功页面：配置完成！]
```

**关键设计点：**

- **4步向导 + 预估时间**：让老周有全局预期，不会感到"不知道还有多少步"
- **模板优先**：储能参数和省份规则都提供预设模板，选择后仅需微调
- **异常数据分类处理**：常见异常（节假日停市）一键确认，非常见异常引导修正
- **每步可回退**：向导支持回到上一步修改，不是"一步错步步错"

### 旅程流程4：储能调度计划审核（李娜+陈工）

**核心路径：** 报价引导/直接导航 → 计划审核 → 微调确认 → 指令下发 → 运维确认

```mermaid
flowchart TD
    A{入口方式} -->|报价完成后引导| A1[从报价提交成功页<br/>点击"去审核储能计划"]
    A -->|直接导航| A2[点击导航栏"储能调度"]

    A1 & A2 --> B[储能调度页 — 三栏布局]
    B --> B1[左栏：储能电站列表<br/>A站 SOC 35% ⚡<br/>C站 SOC 60% ⚡<br/>各站状态一目了然]

    B1 --> C[中央：96时段充放电时间轴]
    C --> C1[甘特图/时间轴展示<br/>充电时段=绿色条<br/>放电时段=橙色条<br/>待机时段=灰色条<br/>叠加电价曲线虚线]

    C1 --> C2[右栏：SOC状态 + Agent摘要]
    C2 --> C2a[SOCGauge仪表盘<br/>当前SOC 35% → 预计运行范围 25%-85%]
    C2 --> C2b[Agent决策摘要<br/>储能Agent：低价时段充电至85%<br/>高价时段放电至25%<br/>负电价时段再次充电]

    C1 --> D{李娜审核计划}
    D -->|满意| E[点击"确认调度计划"]
    D -->|需调整| D1[点击时段条 → 修改功率/时长<br/>如：时段32-36放电15MW→10MW]
    D1 --> D2[填写调整理由<br/>"风电高出力避免并网超限"]
    D2 --> D3[时间轴实时更新<br/>SOC曲线联动变化<br/>调整时段橙色标记]
    D3 --> D4{约束校验}
    D4 -->|通过| D[继续审核]
    D4 -->|超限| D5[红色警告：<br/>"SOC将低于下限10%"<br/>建议调整方案]
    D5 --> D1

    E --> E1{还有储能电站待审核？}
    E1 -->|有| E2[自动切换下一储能电站<br/>进度提示 1/2]
    E2 --> C
    E1 -->|全部完成| F[生成调度指令]

    F --> F1[指令预览：<br/>A站：时段1-20充电12MW<br/>时段25-36放电10-15MW<br/>时段40-48充电12MW]
    F1 --> F2[点击"下发调度指令"]
    F2 --> F3[指令已发送给陈工<br/>状态：待运维确认]

    F3 --> G[陈工运维端]
    G --> G1[收到指令通知]
    G1 --> G2[查看调度指令卡片<br/>时间/功率/方向/SOC变化<br/>设备状态：正常 ✓<br/>安全约束：全部满足 ✓]
    G2 --> G3{陈工确认}
    G3 -->|确认执行| G4[指令进入待执行队列<br/>李娜端状态更新：运维已确认]
    G3 -->|拒绝+理由| G5[指令退回李娜<br/>附带拒绝理由<br/>李娜需重新调整计划]
    G5 --> D1
```

**关键设计点：**

- **双入口设计**：从报价引导进入（主路径）或直接导航进入
- **SOC联动实时更新**：修改充放电功率时，SOC曲线实时变化，直观反馈
- **约束自动校验**：修改超出设备安全范围时立即拦截并给出建议
- **指令结构化卡片**：陈工看到的是清晰的时间/功率/方向，无歧义
- **拒绝闭环**：陈工拒绝时必须填理由，指令退回李娜重新调整

### Journey Patterns

跨4个旅程提取的可复用交互模式：

#### 导航模式

| 模式 | 描述 | 适用旅程 |
|------|------|---------|
| **批量概览→单项深入** | 先看全局列表，再逐项处理 | 报价审核5电站、储能调度2电站 |
| **自动切换下一项** | 确认当前项后自动导航到下一项+进度指示 | 报价逐站审核、储能逐站审核 |
| **流程串联引导** | 完成流程A后引导进入关联流程B（非阻断式） | 报价→储能调度 |

#### 决策模式

| 模式 | 描述 | 适用旅程 |
|------|------|---------|
| **AI建议+人工终审** | AI生成建议→人审核→确认或覆盖→记录理由 | 报价审核、储能调度 |
| **渐进信任路径** | 初期逐项审核→熟悉后批量确认（仅看异常） | 报价审核 |
| **约束实时校验** | 用户操作时实时校验边界约束，超限立即拦截 | 储能功率调整、SOC范围 |

#### 反馈模式

| 模式 | 描述 | 适用旅程 |
|------|------|---------|
| **进度条全局感知** | 顶部进度条显示当前处理进度（3/5） | 报价审核、储能审核、配置向导 |
| **非阻断式成功/错误** | 信息横幅而非弹窗，保持操作流畅性 | 提交成功、导出完成 |
| **数字动画过渡** | KPI数字从0动画到终值，强化视觉冲击力 | 回测首屏 |
| **三级下钻+面包屑** | 全局→中层→明细的层级钻取，面包屑保持位置感知 | 回测数据下钻 |

### Flow Optimization Principles

1. **最少点击到价值**：报价审核批量确认路径可在3次点击内完成（概览→批量确认→提交）
2. **保持上下文**：电站切换保留各站独立状态，不丢失已审核内容
3. **可恢复的操作**：微调后可"恢复AI建议"（单时段级别），配置向导可回退，避免不可逆焦虑
4. **引导而不阻断**：储能引导是卡片提示而非模态弹窗，异常是分组展示而非逐条弹出
5. **渐进式复杂度**：批量快速确认路径为熟练用户提供高效通道，逐站详审路径为新手提供安全感

## Component Strategy

### Design System Components

**Ant Design Vue 4.x 提供的基础组件（L1层，直接使用）：**

| 组件类别 | 可用组件 | 对应场景 |
|---------|---------|---------|
| 布局 | Layout, Sider, Content, Row, Col | 三栏工作台、仪表盘网格 |
| 导航 | Menu, Tabs, Breadcrumb, Steps | 侧边导航、标签切换、面包屑、配置向导 |
| 数据展示 | Table, Card, Statistic, Descriptions, Tag, Badge, Tooltip | 电站列表、KPI卡片、状态标签 |
| 表单 | Form, Input, InputNumber, Select, DatePicker, Upload, Switch | 配置向导、时段微调、数据导入 |
| 反馈 | Alert, Message, Notification, Modal, Drawer, Progress, Spin | 成功横幅、进度条、Agent面板抽屉 |
| 操作 | Button, Dropdown, Popconfirm | 确认提交、批量操作 |

**AntV 图表生态组件：**

| 图表类型 | 对应场景 |
|---------|---------|
| G2Plot Line（折线图） | 月度趋势对比、功率预测曲线 |
| G2Plot Column（柱状图） | 储能贡献对比 |
| G2Plot Waterfall（瀑布图） | 收益归因分解 |
| G2Plot Gauge（仪表盘） | SOC状态展示基础 |
| G2Plot Heatmap（热力图） | 电价热力图基础 |
| G6/X6（图编辑引擎） | EnergyScheduleTimeline的交互基础设施 |

### Custom Components

#### 1. AgentChainViewer — Agent决策链路查看器（核心竞争力组件）

**Purpose：** 以渐进式展开方式展示多Agent协作推理过程，让用户"看到AI是怎么想的"

**Usage：** 交易工作台右侧面板（报价审核时）、储能调度页右侧面板

**Anatomy：**

```
┌─────────────────────────────────────┐
│ Agent决策链路                    ▼ 收起 │
├─────────────────────────────────────┤
│ ✓ 功率预测Agent          耗时 2.1s  │  ← L1 结论层（默认可见）
│   "明日出力预计下降15%"              │
│   ▶ 查看推理详情                     │
├─────────────────────────────────────┤
│ ✓ 电价预测Agent          耗时 1.8s  │
│   "时段25-36电价处于高位区间"         │
│   ▼ 推理详情                        │  ← L2 推理层（展开后）
│ ┌─────────────────────────────────┐ │
│ │ 输入：历史电价、供需数据、天气    │ │
│ │ 分析：供给侧风电出力下降 →       │ │
│ │       需求侧工业负荷正常 →       │ │
│ │       供需偏紧 → 电价上行         │ │
│ │ 置信度：高 ●●●○                  │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ ● 报价策略Agent 计算中...    3.2s   │  ← 进行中状态
│   ████████░░ 80%                    │
├─────────────────────────────────────┤
│ ○ 储能调度Agent             待启动   │  ← 等待状态
├─────────────────────────────────────┤
│ ○ 风控审计Agent             待启动   │
└─────────────────────────────────────┘
```

**States：**

| 状态 | 视觉表现 | 说明 |
|------|---------|------|
| 等待中 | 灰色空心圆○ + "待启动" | Agent尚未开始 |
| 计算中 | 蓝色动画圆● + 进度条 + 耗时计时 | Agent正在执行 |
| 已完成 | 绿色勾✓ + 一句话结论 + 耗时 | Agent执行完毕 |
| 异常/降级 | 橙色警告△ + 降级说明 | Agent执行异常但有降级方案 |
| 失败 | 红色叉✗ + 错误摘要 | Agent执行失败 |

**Variants：**

| 变体 | 场景 | 差异 |
|------|------|------|
| **实时模式** | 30秒报价生成期间 | 步骤条逐步推进，当前Agent显示进度条 |
| **结果模式** | 报价生成完成后审核 | 全部Agent已完成，关注L1/L2展开查看 |
| **精简模式** | 批量概览视图中 | 单行摘要：✓4 ⚠1 + 异常Agent名称（如"电价预测Agent置信度低"），不需点进即可判断是否需深入审核 |

**实时模式WebSocket事件格式：**

```typescript
interface AgentStatusEvent {
  agentId: string           // 'power-forecast' | 'price-forecast' | 'strategy' | 'storage' | 'risk-audit'
  status: 'waiting' | 'running' | 'completed' | 'degraded' | 'failed'
  progress: number          // 0-100，仅running状态有意义
  elapsedTime: number       // 毫秒
  summary?: string          // 完成后的一句话结论
  details?: AgentReasoningDetail  // 完成后的L2推理详情
}
```

**Interaction Behavior：**
- 点击Agent行 → 展开/折叠L2推理详情（手风琴模式，同时只展开一个）
- L2推理详情使用自然语言摘要，非技术日志
- 置信度用圆点（●●●○ 高/●●○○ 中/●○○○ 低）+ 颜色（绿/橙/红）
- 实时模式下自动滚动到当前执行的Agent

**Accessibility：**
- 每个Agent行为可聚焦元素，支持Enter/Space展开折叠
- 状态变化通过aria-live="polite"通知屏幕阅读器
- 置信度圆点有对应的aria-label文本描述

**底层实现：** 基于 a-collapse（手风琴）+ a-steps（进度指示）+ a-progress（进度条）组合

#### 2. Period96Grid — 96时段报价网格（核心操作组件）

**Purpose：** 展示和编辑96个交易时段的报量报价数据，支持批量确认+单时段微调

**Usage：** 交易工作台中央面板

**Anatomy：**

```
┌────┬───────┬────────┬────────┬────────┬────────┬──────┬──────┐
│时段│ 时间   │预测出力 │ 报量   │电价预测 │ 报价   │储能  │ 状态 │
│    │       │  MW    │  MW    │ ¥/MWh  │ ¥/MWh  │策略  │      │
├────┼───────┼────────┼────────┼────────┼────────┼──────┼──────┤
│ 1  │00:00  │ 12.5   │ 12.5   │  285   │  290   │ 充电 │ ✓ AI │
│ 2  │00:15  │ 11.8   │ 11.8   │  278   │  282   │ 充电 │ ✓ AI │
│...                                                           │
│ 32 │08:00  │  8.2   │  8.2   │  420   │  385   │ 放电 │ ✎ 调 │
│...                                                           │
│ 45 │11:15  │ 15.0   │  0.0   │  -80   │   0    │ 充电 │ ⚠ 负 │
│...                                                           │
│ 96 │23:45  │ 14.2   │ 14.2   │  310   │  315   │ 待机 │ ✓ AI │
├────┴───────┴────────┴────────┴────────┴────────┴──────┴──────┤
│ 汇总：总报量 XXX MWh │ 预估收益 ¥XX万 │ 人工调整 3/96时段    │
└──────────────────────────────────────────────────────────────┘
```

**States：**

| 行状态 | 背景色 | 标识 | 说明 |
|--------|-------|------|------|
| AI建议（正常） | 白色 | ✓ AI（绿色Tag） | AI建议未经修改 |
| 人工调整 | 浅橙背景 #FFF7E6 | ✎ 调（橙色Tag） | 交易员已微调 |
| 负电价预警 | 浅红背景 #FFF1F0 | ⚠ 负（红色Tag） | 预测负电价时段 |
| 需关注 | 浅黄背景 #FFFBE6 | ! 注（黄色Tag） | 低置信度或异常 |
| 选中编辑 | 蓝色边框高亮 | — | 当前正在编辑的时段 |

**Interaction Behavior：**
- **单击报量/报价单元格** → 进入编辑模式（inline edit），数字变为InputNumber
- **编辑确认** → Enter保存 / Esc取消 / Tab跳到同行下一可编辑列（报量→报价），行尾后跳到下一行第一个可编辑列
- **方向键导航** → ↑↓←→在单元格间移动焦点，到边界时停留不循环（符合Excel用户肌肉记忆）
- **行上下文菜单** → 右键或点击行尾"..."按钮：恢复AI建议 / 填写调整理由 / 查看Agent链路详情
- **列头排序** → 点击列头可按电价/报价/状态排序，快速定位关注时段
- **批量操作** → Shift+Click多选时段，右键批量恢复AI建议或批量确认
- **顶部筛选条** → 快速筛选：全部 / 仅需关注 / 仅负电价 / 仅人工调整

**Variants：**

| 变体 | 场景 | 差异 |
|------|------|------|
| **完整编辑模式** | 单站详审视图 | 全部96行×8列，可编辑 |
| **只读汇总模式** | 批量概览视图 | 仅显示需关注时段（通常20-30行），不可编辑，无需虚拟滚动 |
| **对比模式** | 回测分析下钻 | AI建议 vs 实际执行 双列对比 |

**性能策略：** 单站96行无需虚拟滚动。批量概览视图仅展示需关注时段（经筛选后通常20-30行），不展示5站×96全量数据，因此同样无需虚拟滚动。

**Accessibility：**
- 网格使用role="grid"，单元格使用role="gridcell"
- 方向键导航符合WAI-ARIA grid pattern
- 编辑模式切换通过aria-readonly属性标识
- 行状态通过aria-label描述（如"时段45，负电价预警"）

**底层实现：** 基于 a-table（compact模式）+ 自定义单元格渲染 + InputNumber内联编辑

#### 3. SOCGauge — 储能SOC状态仪表盘

**Purpose：** 直观展示储能设备当前SOC百分比及安全运行范围

**Usage：** 储能调度页右侧面板、交易工作台储能电站概览

**States：**

| 状态 | 仪表盘颜色 | 说明 |
|------|-----------|------|
| 正常范围 | 绿色(#52C41A) | SOC在安全上下限之间 |
| 接近下限 | 橙色(#FA8C16) | SOC接近安全下限（如<20%） |
| 接近上限 | 橙色(#FA8C16) | SOC接近安全上限（如>85%） |
| 超限警告 | 红色(#FF4D4F) | SOC超出安全运行范围 |
| 设备离线 | 灰色(#BFBFBF) | 设备通信中断 |

**Variants：**

| 变体 | 尺寸 | 场景 | 呈现方式 |
|------|------|------|---------|
| **标准** | 200×200px | 储能调度页右侧面板 | 完整仪表盘图形 + SOC数字 + 安全范围色带 |
| **迷你** | 内联文本级 | 电站列表卡片中 | 仅SOC百分比数字 + 水平颜色条（绿/橙/红），不使用仪表盘图形，适配列表信息密度 |
| **带预测曲线** | 200×280px | 储能调度页详情 | 标准仪表盘 + 下方叠加96时段SOC变化折线图 |

**底层实现：** 标准/带预测曲线变体基于 AntV G2Plot Gauge + 自定义安全范围色带；迷你变体为纯CSS组件（a-progress + 颜色映射）

#### 4. RevenueWaterfall — 收益归因瀑布图

**Purpose：** 分解展示AI策略增收的各项归因来源，像财务报表一样清晰地展示"钱从哪里来"

**Usage：** 回测分析报告第二屏、收益看板月度汇总

**States：**

| 状态 | 说明 |
|------|------|
| 正向贡献 | 绿色柱体，向上增长 |
| 负向贡献 | 红色柱体，向下减少 |
| 总计 | 深蓝色柱体，汇总最终值 |
| hover高亮 | 柱体颜色加深 + 浮动卡片显示明细 |

**Interaction Behavior：**
- hover柱体 → 浮动Tooltip显示：归因类别、金额、占比百分比、典型案例
- 点击柱体 → 下钻到该归因类别的月度明细
- 支持切换绝对值/百分比视图

**Variants：**

| 变体 | 场景 | 差异 |
|------|------|------|
| **全年汇总** | 回测报告首屏 | 3-5个归因维度，大字号 |
| **月度对比** | 收益看板 | 紧凑版，嵌入卡片中 |
| **含储能分项** | 有储能电站 | 增加储能子分项：峰谷套利+偏差平滑+负电价避损 |

**底层实现：** 基于 AntV G2Plot Waterfall + 自定义Tooltip + 颜色映射

#### 5. PowerForecastChart — 功率预测对比曲线

**Purpose：** 展示96时段功率预测值与实际出力的对比，支持置信区间展示

**Usage：** 交易工作台顶部态势感知条、回测分析下钻详情

**States：**

| 状态 | 说明 |
|------|------|
| 仅预测 | 只有预测曲线+置信区间（日前场景，尚无实际数据） |
| 预测+实际 | 双曲线叠加（回测场景或实时跟踪） |
| 偏差高亮 | 预测与实际差异大的时段区间用红色背景标记 |

**Interaction Behavior：**
- hover时段 → Tooltip显示：时段号、时间、预测值、实际值（如有）、偏差率
- 框选缩放 → 拖拽选择时段范围放大查看
- 双击重置 → 恢复全96时段视图
- 与Period96Grid联动 → hover图表时段，网格对应行高亮；反之亦然

**底层实现：** 基于 AntV G2Plot Line + Area（置信区间）+ 双Y轴（功率+电价叠加时）

#### 6. EnergyScheduleTimeline — 96时段充放电时间轴

**Purpose：** 甘特图式展示储能96时段充电/放电/待机计划，叠加电价曲线

**Usage：** 储能调度页中央面板

**颜色编码：**
- 充电时段：绿色条(#73D13D)
- 放电时段：橙色条(#FFA940)
- 待机时段：灰色条(#BFBFBF)
- 人工调整段：橙色边框标识

**States：**

| 状态 | 说明 |
|------|------|
| 计划模式 | 可编辑，点击时段条修改功率/时长 |
| 执行中模式 | 只读，当前时段高亮闪烁，已执行段实心已规划段半透明 |
| 历史模式 | 只读，叠加实际执行结果对比 |

**Interaction Behavior：**
- 点击时段条 → 弹出编辑浮层：修改功率(MW)、修改时段范围
- 拖拽时段条边缘 → 调整时段范围
- 修改功率 → SOCGauge和SOC变化曲线实时联动更新
- hover时段条 → Tooltip：时段范围、功率、方向、SOC变化、关联报价策略
- 点击"查看关联报价" → 交叉引用跳转到交易工作台对应时段

**底层实现：** 基于 AntV X6（图编辑引擎）构建，复用其交互基础设施（缩放、拖拽、事件系统），叠加 G2Plot Line（电价曲线）。不使用纯Canvas从零开发，降低MVP实现风险。

### Component Implementation Strategy

**组件分层总览：**

| 层级 | 数量 | 策略 |
|------|------|------|
| **L1 基础层**（Ant Design Vue原生） | ~30个 | 直接使用，通过ConfigProvider全局主题定制 |
| **L2 业务层**（通用业务组合组件） | 8个 | 基于L1组合封装 |
| **L3 领域层**（电力交易专用） | 6个 | 自定义设计+开发 |

**L2 业务层组件清单：**

| 组件 | 描述 | 组合来源 |
|------|------|---------|
| DataCard | 数据卡片（KPI展示） | a-card + a-statistic |
| StatusBadge | 状态徽章（电站/Agent/指令状态） | a-badge + a-tag |
| TimeRangeSelector | 时段范围选择器 | a-date-picker + 自定义96时段映射 |
| StationSwitcher | 电站切换器（带进度指示） | a-tabs + StatusBadge + 自定义进度 |
| FilterBar | 筛选条（全部/需关注/负电价） | a-radio-group + a-badge |
| ConfirmBanner | 非阻断式确认/成功横幅 | a-alert + 自动消失逻辑 |
| GuideCard | 流程引导卡片（储能引导等） | a-card + a-button + 可关闭 |
| AdjustReasonInput | 调整理由输入 | a-select（常用理由下拉：本地气象判断不同/市场特殊情况/设备检修/其他）+ a-input（自定义输入），选择常用理由后可追加补充说明，整个交互不打断微调流程 |

**跨组件状态管理方案：**

使用 Pinia store 统一管理跨组件共享状态，各组件通过Vue 3响应式系统订阅更新，不使用事件总线：

| Store | 管理数据 | 订阅组件 |
|-------|---------|---------|
| **useStationStore** | 当前电站信息、电站列表、切换状态 | StationSwitcher, Period96Grid, AgentChainViewer, PowerForecastChart |
| **usePeriod96Store** | 当前电站96时段报量报价数据、编辑状态、筛选状态 | Period96Grid, PowerForecastChart, AgentChainViewer |
| **useStorageStore** | 储能SOC数据、充放电计划、约束参数 | SOCGauge, EnergyScheduleTimeline, Period96Grid（储能列） |
| **useAgentStore** | Agent执行状态、推理链路数据 | AgentChainViewer, Period96Grid（状态列） |

**联动机制：** 组件通过computed属性订阅store中的响应式数据，store中数据变更自动触发所有订阅组件重新渲染。例如：EnergyScheduleTimeline修改充放电功率 → 更新useStorageStore → SOCGauge自动响应更新预测SOC值。

### Implementation Roadmap

**Phase 1 — MVP核心（Month 1-2）：**

| 优先级 | 组件 | 依赖页面 | 复杂度 | 备注 |
|--------|------|---------|--------|------|
| P0 | **Period96Grid** | 交易工作台 | 中等 | inline编辑+颜色语义+键盘导航 |
| P0 | **AgentChainViewer** | 交易工作台、储能调度 | 中等 | 手风琴展开+实时模式+WebSocket集成 |
| P0 | **RevenueWaterfall** | 回测分析 | 低 | G2Plot Waterfall定制 |
| P1 | **SOCGauge** | 储能调度 | 低 | G2Plot Gauge+安全范围色带 |
| P1 | **PowerForecastChart** | 交易工作台 | 低 | G2Plot Line+Area组合 |
| P1 | **EnergyScheduleTimeline** | 储能调度 | 高 | AntV X6构建+可编辑交互+SOC联动 |

**L2组件开发顺序（按依赖关系排列）：**

| 顺序 | 组件 | 被依赖者 | 说明 |
|------|------|---------|------|
| 1 | StatusBadge | StationSwitcher, AgentChainViewer精简模式 | 最底层业务组件，无外部依赖 |
| 2 | FilterBar | Period96Grid | Period96Grid的筛选功能依赖此组件 |
| 3 | DataCard | 回测报告、收益看板 | 独立组件，可并行开发 |
| 4 | ConfirmBanner | 所有提交操作 | 独立组件，可并行开发 |
| 5 | AdjustReasonInput | Period96Grid, EnergyScheduleTimeline | 微调交互的核心辅助组件 |
| 6 | StationSwitcher | 交易工作台、储能调度页 | 依赖StatusBadge |
| 7 | GuideCard | 报价→储能引导 | 独立组件，低优先级 |
| 8 | TimeRangeSelector | 回测分析 | 独立组件，回测页开发时同步完成 |

**Phase 2 — 增强迭代（Month 3+）：**
- Period96Grid对比模式（回测分析下钻）
- PowerForecastChart实时跟踪模式
- EnergyScheduleTimeline执行中模式
- 收益看板仪表盘卡片组合

**跨组件联动规范：**

| 联动关系 | 触发 | 响应 | 通过Store |
|---------|------|------|----------|
| 图表↔网格 | hover PowerForecastChart某时段 | Period96Grid对应行高亮 | usePeriod96Store.hoveredPeriod |
| 时间轴↔SOC | 修改EnergyScheduleTimeline功率 | SOCGauge实时更新预测值 | useStorageStore.schedulePlan |
| 网格→Agent | 点击Period96Grid某时段"查看详情" | AgentChainViewer定位到该时段推理 | useAgentStore.focusedPeriod |
| 时间轴→报价 | 点击EnergyScheduleTimeline"查看关联报价" | 跳转交易工作台对应时段 | 路由导航 + usePeriod96Store.scrollToPeriod |

## UX Consistency Patterns

### Button Hierarchy

**按钮层级体系：**

| 层级 | 样式 | 典型操作 | 使用规则 |
|------|------|---------|---------|
| **主要操作（Primary）** | 实心深蓝按钮(#1B3A5C) | 提交全部报价、确认调度计划、完成配置 | 每个视图/页面最多1个Primary按钮，代表该视图的"终极目标操作" |
| **次要操作（Secondary）** | 描边按钮（白底深蓝边框） | 确认本站报价、下发调度指令、导出PDF | 重要但非终极操作，一个视图可有2-3个 |
| **常规操作（Default）** | 浅灰底按钮 | 筛选、排序、恢复AI建议、查看详情 | 辅助性操作，数量不限 |
| **文本操作（Link）** | 纯文本链接样式 | 查看推理详情、查看关联报价、了解更多 | 信息浏览类操作，不改变数据状态 |

**危险操作规范：**

| 操作类型 | 样式 | 确认方式 |
|---------|------|---------|
| 覆盖AI建议（单时段） | Default按钮 | 无需确认，直接生效（可恢复） |
| 覆盖AI建议（批量） | Default按钮 | Popconfirm气泡确认："确认批量恢复X个时段的AI建议？" |
| 提交全部报价 | Primary按钮 | 无模态弹窗，但提交前展示汇总确认页（480时段/X个调整/预估收益） |
| 拒绝调度指令（陈工） | 红色描边按钮 | 必须填写拒绝理由后按钮才可点击 |
| 删除电站配置 | 红色文本按钮 | Modal确认对话框："删除后相关历史数据将保留但无法继续使用" |

**按钮文案规范：**
- 用动词开头："提交报价"、"确认计划"、"导出报告"、"恢复AI建议"
- 不用"确定"、"好的"等模糊词汇
- 人工覆盖操作不使用质疑语气——"记录调整理由"而非"确定覆盖AI建议？"

**按钮位置规范：**
- Primary按钮固定在内容区右下角或底部操作栏
- 批量概览的"提交全部报价"固定在页面底部操作栏（sticky），滚动时始终可见
- 表格行内操作使用"..."下拉菜单，不铺满按钮

### Feedback Patterns

**反馈类型与呈现方式：**

| 类型 | 组件 | 持续时间 | 位置 | 颜色 | 典型场景 |
|------|------|---------|------|------|---------|
| **操作成功** | Message（顶部消息条） | 3秒自动消失 | 页面顶部居中 | 绿色(#52C41A) | 单站报价确认、单时段微调保存 |
| **流程完成** | ConfirmBanner（自定义横幅） | 手动关闭或10秒消失 | 内容区顶部 | 绿色背景 | 全部报价提交成功、调度指令已下发 |
| **警告提示** | Alert（内嵌警告条） | 持续显示直到条件消失 | 相关内容区上方 | 橙色(#FA8C16) | 数据超24小时未更新、AI置信度低 |
| **错误反馈** | ConfirmBanner（错误横幅） | 手动关闭 | 内容区顶部 | 红色(#FF4D4F) | 提交失败、数据导入错误 |
| **系统状态** | Alert（信息横幅） | 持续显示直到恢复 | 页面顶部全宽 | 蓝色(#1890FF) | AI降级运行中、系统维护通知 |
| **Agent进度** | AgentChainViewer实时模式 | 持续显示直到完成 | 交易工作台右侧面板 | 蓝色动画 | 30秒报价生成期间 |

**核心原则：非阻断优先**
- 成功/警告/信息：绝不使用模态弹窗（Modal），全部使用Message、Alert或横幅
- 仅以下场景使用Modal：删除不可恢复的数据、PDF导出预览（需要大面积内容展示）
- 错误反馈必须包含可操作的下一步："提交失败，请检查网络后重试"而非"Error 500"

**加载反馈规范：**

| 加载时长 | 反馈方式 |
|---------|---------|
| <300ms | 无反馈（用户无感知） |
| 300ms-2s | 按钮loading态（Spin图标替换按钮文字） |
| 2s-10s | 内容区Skeleton骨架屏 |
| 10s-30s | AgentChainViewer步骤条实时进度（报价生成场景） |
| >30s | 进度条+预估剩余时间+可取消（数据导入/回测计算） |

**数字动画规范（回测报告专用）：**
- KPI大数字使用CountUp动画：从0过渡到终值，持续1.2秒
- 瀑布图柱体使用G2Plot内置入场动画：从下方向上生长，依次延迟0.2秒
- 仅在首次加载时播放动画，切换参数重新加载时不重复播放

### Form Patterns

**验证时机策略：**

| 时机 | 场景 | 行为 |
|------|------|------|
| **即时验证（onChange）** | Period96Grid单时段报价修改 | 修改后立即校验是否在限价范围内，超范围红色边框+Tooltip提示 |
| **失焦验证（onBlur）** | 配置向导表单字段 | 离开字段后校验格式和范围 |
| **提交前验证** | 提交全部报价、完成配置 | 汇总页展示所有问题，不允许带错误提交 |
| **实时约束校验** | 储能功率调整 | 修改功率时实时计算SOC是否越界，超限立即拦截 |

**验证反馈样式：**

| 级别 | 表现 | 说明 |
|------|------|------|
| **错误** | 红色边框 + 红色提示文字 | 必须修正才能继续（如报价超出限价范围） |
| **警告** | 橙色边框 + 橙色提示文字 | 建议修正但不阻止操作（如报价偏离AI建议>30%） |
| **成功** | 绿色边框（仅闪烁1秒后消失） | 校验通过确认，不持续显示避免视觉噪音 |

**错误提示文案规范：**
- 说明什么错了 + 怎么修正："报价385元/MWh超出本省限价上限380元/MWh，请调整至380以内"
- 不使用技术错误码或通用提示
- 配置向导中，每个字段旁有"?"图标，hover显示字段含义和填写示例

**表单布局规范：**
- 配置向导：每步最多5-7个字段，超过则拆分为子步骤
- 标签位置：表单字段label在输入框上方（顶部对齐），不使用左侧对齐（节省水平空间）
- 必填标识：必填字段label后红色星号(*)，非必填字段label后灰色"(选填)"

### Navigation Patterns

**全局导航结构：**

```
┌──────────────────────────────────────────────┐
│ ≡ Logo ElectricityTradingPlatform    hmeng ▼ │
├────────┬─────────────────────────────────────┤
│        │                                     │
│ 📊 工作台│  [主内容区]                         │
│ ⚡ 储能  │                                     │
│ 📈 回测  │                                     │
│ 📋 看板  │                                     │
│ ⚙ 配置  │                                     │
│        │                                     │
│ ──── │                                     │
│ 📖 帮助  │                                     │
└────────┴─────────────────────────────────────┘
```

**导航规范：**
- 左侧导航栏固定240px宽，深色背景(#0A1929)，白色文字/图标
- 当前页面高亮：左侧蓝色竖条(4px) + 浅蓝背景
- 导航项：图标 + 中文名称，5个主要入口 + 1个底部帮助入口
- 不使用多级折叠菜单——5个页面足够平铺，减少导航层级

**电站切换规范（StationSwitcher）：**

| 场景 | 切换方式 | 状态保持 |
|------|---------|---------|
| 交易工作台 | 顶部标签式切换（a-tabs），每个标签显示电站名+状态Badge | 各电站独立维护96时段编辑状态，切走不丢失 |
| 储能调度页 | 左侧列表点击切换 | 各储能电站独立维护计划编辑状态 |
| 回测分析 | 下拉选择器（a-select），支持多选 | 切换后重新加载数据 |

**面包屑规范：**
- 仅在回测分析的下钻场景使用面包屑导航
- 格式："回测分析 > 2024年3月 > 3月15日 > 时段32"
- 每级可点击回到对应层级

**交叉引用跳转规范：**
- 所有交叉引用使用蓝色文本链接样式（Link按钮）
- 跳转后目标页面高亮对应时段/区域（黄色闪烁2秒后消失）
- 浏览器后退键可返回跳转前页面

### Empty & Loading States

**空状态分类：**

| 场景 | 视觉表现 | 引导操作 |
|------|---------|---------|
| **首次使用（无电站配置）** | 居中插画 + "欢迎使用！开始配置您的第一个电站" | Primary按钮："开始配置向导" |
| **无报价任务（当日已提交/非交易日）** | 简洁文案 + 上次提交状态卡片 | "今日报价已提交。查看提交记录 >" |
| **无回测数据（数据不足）** | 说明文案 + 数据要求提示 | "需要至少30天历史数据才能生成回测。当前数据：12天" |
| **筛选结果为空** | 简洁文案 | "没有符合筛选条件的时段。清除筛选 >" |
| **储能电站无储能设备** | 灰色提示区域 | "该电站未配置储能设备。如需添加，请联系管理员配置" |

**空状态设计原则：**
- 不使用大面积空白——空状态永远提供下一步操作引导
- 使用简洁的线条插画风格（与Ant Design设计语言一致），不使用卡通或3D插画
- 空状态文案用陈述句+操作链接，不用问句

**加载状态分场景设计：**

| 页面 | 加载方式 | 说明 |
|------|---------|------|
| 交易工作台首次加载 | 骨架屏（Skeleton）：左侧电站列表骨架 + 中央网格骨架 + 右侧面板骨架 | 保持三栏布局结构，让用户预期内容分布 |
| 报价生成中（30秒） | AgentChainViewer步骤条实时进度 | 不使用骨架屏，而是展示"AI在思考"的有意义过程 |
| 回测数据加载 | Hero区KPI卡片显示为"--"占位 + 旋转加载图标 | 保持页面结构，数据到位后数字动画入场 |
| 切换电站 | 中央区域半透明遮罩 + Spin旋转图标 | 快速切换（<500ms），保持上下文连续性 |
| 数据导入处理 | 进度条 + 百分比 + "正在解析第X/Y条数据" | 长时间操作，提供具体进度和可取消操作 |
| PDF导出生成 | 模态进度条 + "正在生成报告..." | 完成后自动触发浏览器下载 |

### Data Anomaly & Degradation Patterns

**数据新鲜度标识系统：**

| 数据状态 | 视觉表现 | 位置 |
|---------|---------|------|
| **正常（<2小时）** | 无特殊标识 | — |
| **略过期（2-12小时）** | 灰色时间戳："数据更新于 X小时前" | 相关面板右上角 |
| **过期（12-24小时）** | 橙色Alert横幅："电价数据已超12小时未更新" | 相关面板上方 |
| **严重过期（>24小时）** | 红色Alert横幅 + 报价按钮置灰 | 页面顶部全宽 + 禁止提交 |

**AI降级模式：**

| 降级场景 | 用户提示 | 操作影响 |
|---------|---------|---------|
| **单个Agent降级** | AgentChainViewer中该Agent显示橙色△ + "功率预测Agent使用备用模型，置信度降低" | 报价建议仍可生成，该Agent相关时段标记为"需关注" |
| **多Agent降级** | 页面顶部蓝色信息横幅："AI分析服务部分降级运行中，建议更谨慎审核报价建议" | 所有时段标记为"需关注"，批量快速确认路径不可用 |
| **AI完全不可用** | 页面顶部红色横幅："AI分析服务暂时不可用。您可以手动填写报价，或等待服务恢复" | 隐藏AgentChainViewer面板，Period96Grid切换为纯手动输入模式 |

**设备异常（储能）：**

| 异常场景 | 用户提示 | 操作影响 |
|---------|---------|---------|
| **设备通信中断** | SOCGauge显示灰色 + "设备离线" | 禁止下发新调度指令，已有指令状态显示"待确认设备状态" |
| **SOC数据异常** | SOCGauge显示红色边框 + "SOC数据异常，请确认设备状态" | 允许查看计划但禁止确认，需运维员确认设备状态 |
| **约束参数超限** | 编辑时实时红色警告 + 建议调整方案 | 超限指令自动拦截，必须调整至安全范围内 |

**异常处理的交互原则：**
- **温和告知，不恐慌**：使用Alert横幅而非模态弹窗，用户可继续操作可操作部分
- **清晰说明影响范围**：不只说"有错误"，而是具体说明"哪里有问题、影响什么、怎么处理"
- **提供降级方案**：AI不可用时切换手动模式，数据过期时允许查看但限制提交
- **不隐藏问题**：系统宁可多提示也不静默失败——但用分级提醒（颜色+位置）而非统一弹窗

## Responsive Design & Accessibility

### Responsive Strategy

**Desktop-Only策略（MVP）：** 本产品MVP阶段为纯桌面应用，不做移动端适配。目标用户全部在办公室桌面环境操作，交易工作台96时段网格和三栏布局在移动端无法有效呈现，国企办公场景不存在移动办公刚需。

### Breakpoint Strategy

| 断点 | 宽度范围 | 适配场景 | 布局策略 |
|------|---------|---------|---------|
| **标准桌面** | 1920px+ | 主要目标，企业办公显示器 | 三栏完整展开，信息密度最高 |
| **小桌面** | 1440px-1919px | 笔记本电脑外接显示器 | 三栏布局，右侧Agent面板默认收起为图标栏，点击展开为Drawer |
| **笔记本** | 1280px-1439px | 笔记本内置屏幕 | 两栏布局（隐藏左侧电站列表为抽屉），Agent面板为Drawer |
| **最小支持** | 1024px-1279px | 老旧办公显示器/信创环境 | 显示降级提示："建议使用1280px以上分辨率以获得最佳体验"，基础功能可用但布局紧凑 |
| **<1024px** | 不支持 | — | 显示提示页："请使用桌面浏览器访问本系统" |

**各页面响应式适配：**

| 页面 | 1920px+（标准） | 1440px-1919px（小桌面） | 1280px-1439px（笔记本） |
|------|---------------|---------------------|---------------------|
| 交易工作台 | 三栏完整展开 | 右侧Agent面板收起为图标栏 | 左侧电站列表收起为抽屉+Agent面板为Drawer |
| 储能调度 | 三栏完整展开 | 右侧SOC/Agent面板收起 | 两栏+右侧Drawer |
| 回测分析 | 满宽叙事布局(max-width:1400px) | 满宽叙事布局(max-width:1200px) | 满宽叙事布局(max-width:1000px) |
| 收益看板 | 4列卡片网格 | 3列卡片网格 | 2列卡片网格 |
| 系统配置 | 居中表单(max-width:800px) | 居中表单(max-width:700px) | 居中表单(max-width:600px) |

**Period96Grid响应式处理：**

| 屏幕宽度 | 网格可用宽度 | 列处理 |
|---------|------------|--------|
| 1920px+ | ~1360px | 完整8列全部显示 |
| 1440px-1919px | ~1200px（Agent面板收起后） | 完整8列，列宽略压缩 |
| 1280px-1439px | ~1040px | 隐藏"储能策略"列，hover行时Tooltip展示；其余7列紧凑显示 |

### Accessibility Strategy

**WCAG合规目标：WCAG 2.1 AA级别**

选择AA的原因：企业级应用行业标准；国企办公环境用户群体相对固定；AA已覆盖色彩对比度、键盘导航、屏幕阅读器等核心需求。

**色彩无障碍 — 不仅靠颜色传达信息：**

| 信息类型 | 颜色 | 辅助标识 |
|---------|------|---------|
| 负电价时段 | 红色背景 | ⚠图标 + "负"文字Tag（三重标识） |
| 充电时段 | 绿色条 | ▼箭头图标 + "充电"标签 |
| 放电时段 | 橙色条 | ▲箭头图标 + "放电"标签 |
| 待机时段 | 灰色条 | ─横线图标 + "待机"标签 |
| 人工调整 | 橙色背景 | ✎编辑图标 + "调"Tag |
| Agent状态 | 绿/蓝/橙/红 | ✓/●/△/✗ 图标 + 状态文字 |

**键盘导航：**

全局键盘支持：
- Tab键按逻辑顺序在可交互元素间导航
- 所有可点击元素有可见的focus样式（2px蓝色实线轮廓）
- Esc键关闭当前打开的Drawer/Modal/Dropdown
- 侧边导航栏支持↑↓键在菜单项间移动，Enter键进入页面

Period96Grid键盘导航：
- 方向键（↑↓←→）在单元格间移动焦点，到边界停留不循环
- Enter键进入编辑模式，再次Enter保存
- Esc键取消编辑恢复原值
- Tab键在编辑模式下跳到同行下一可编辑列
- Home/End键跳到当前列第一行/最后一行
- Ctrl+Home/Ctrl+End跳到网格第一个/最后一个单元格

快捷键（高级用户）：

| 快捷键 | 功能 | 页面 |
|--------|------|------|
| Ctrl+Enter | 确认本站报价 / 确认调度计划 | 交易工作台 / 储能调度 |
| Ctrl+Shift+Enter | 提交全部报价 | 交易工作台批量概览 |
| Alt+1~5 | 切换电站标签（第1-5个电站） | 交易工作台 |
| Alt+← / Alt+→ | 切换上一个/下一个电站 | 交易工作台 / 储能调度 |
| Ctrl+E | 展开/收起Agent面板 | 交易工作台 / 储能调度 |
| Ctrl+F | 聚焦筛选条 | 交易工作台 |

**屏幕阅读器支持 — ARIA标注规范：**

| 组件 | ARIA标注 |
|------|---------|
| Period96Grid | role="grid"，每行aria-label含时段号、报量、报价、状态 |
| AgentChainViewer | role="region" aria-label="Agent决策链路"，每Agent行role="button" aria-expanded |
| SOCGauge | role="meter" aria-valuenow/min/max aria-label="储能电量" |
| StationSwitcher | role="tablist"，每标签role="tab" aria-selected |
| 步骤进度条 | role="progressbar" aria-valuenow/max aria-label="Agent执行进度" |

动态内容通知：Agent状态变化使用aria-live="polite"；错误/成功反馈使用aria-live="assertive"。

### Testing Strategy

**浏览器兼容测试：**

| 浏览器 | 版本要求 | 优先级 |
|--------|---------|--------|
| Chrome | 最新2个大版本 | P0 |
| Edge | 最新2个大版本 | P0 |
| 360安全浏览器（极速模式） | 最新版 | P1（信创环境） |
| 奇安信可信浏览器 | 最新版 | P1（信创环境） |
| Firefox | 最新2个大版本 | P2 |

**无障碍测试：**

| 工具 | 用途 | 集成方式 |
|------|------|---------|
| axe-core | 自动化无障碍检测 | CI/CD集成，PR检查 |
| Lighthouse | 综合无障碍评分 | 每次发版前运行 |
| 键盘导航手动测试 | Tab顺序、焦点管理、快捷键 | 每个页面发版前手动验证 |
| 色彩对比度检查 | 所有文字/背景组合 | 设计评审时确认 |

### Implementation Guidelines

**HTML语义化：**
- 页面标题使用h1-h3层级结构
- 导航区域使用nav元素，主内容区使用main元素
- 表单使用fieldset + legend分组
- Period96Grid使用table元素，不使用div模拟表格

**焦点管理：**
- Modal/Drawer打开时焦点自动移入，关闭时焦点返回触发元素
- 页面跳转后焦点移到主内容区第一个可交互元素
- 电站切换后焦点移到新电站的第一个可操作区域

**CSS实施：**
- 字号使用rem单位（基于html font-size: 14px）
- 布局使用px固定宽度（侧边栏240px）+ flex弹性（主内容区）
- 断点媒体查询使用min-width（桌面优先策略）
- 不使用!important覆盖Ant Design Vue样式，统一通过ConfigProvider theme token定制
