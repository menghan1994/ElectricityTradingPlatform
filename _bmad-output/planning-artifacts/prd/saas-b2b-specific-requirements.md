# SaaS B2B Specific Requirements

## 租户模型（Tenant Model）

**架构：单租户隔离部署**
- 每个客户（省级新能源公司）独立实例部署，数据物理隔离
- 适配国资企业对数据安全的硬性要求——不同客户的交易数据、发电数据、AI模型参数完全隔离
- 每个实例可独立配置省份市场规则、AI模型参数、数据接入源

**电站级数据隔离：**
- 同一客户实例内，按电站维度进行数据隔离
- 交易员仅能访问自己负责的电站数据和操作界面
- 交易主管和管理层可跨电站查看汇总数据

**实例管理：**
- 容器化部署（Docker/K8s），每个客户实例可独立升级、回滚
- 统一的实例管理后台（内部运维用），监控各客户实例健康状态
- 支持客户内网/私有云环境部署

## 权限矩阵（RBAC Matrix）

| 角色 | 典型用户 | 核心权限 | 数据范围 |
|------|---------|---------|---------|
| **系统管理员** | 老周（配置员） | 电站配置、市场规则配置、数据导入导出、用户管理、模型配置 | 全部电站 |
| **交易员** | 李娜 | 查看功率/电价预测、审核/微调/确认AI报价、查看负责电站收益、记录调整理由 | 仅分配的电站 |
| **交易主管** | 赵磊 | 全部交易员权限 + 跨电站收益汇总、按人绩效分析、回测报告管理、报告导出（PDF）、交易员绩效对比 | 全部电站 |
| **储能运维员** | 陈工 | 查看储能调度计划、确认/拒绝充放电指令、反馈设备异常、查看储能运行状态和SOC | 仅分配的储能设备 |
| **高管只读** | 王总 | 查看收益看板、回测报告、导出PDF报告 | 全部电站（只读） |

**权限设计原则：**
- 最小权限原则：每个角色仅获得完成工作所需的最小权限
- 电站绑定：交易员与电站的绑定关系由系统管理员配置，支持一对多；储能运维员与储能设备的绑定关系同理
- 操作审计：所有角色的关键操作（报价确认、数据导入、配置变更）均记录审计日志

## 订阅层级（Subscription Tiers）

**定价维度：电站数量 × 功能模块 × 省份**

| 维度 | 说明 |
|------|------|
| **电站数量** | 按接入管理的电站数量阶梯计费（如1-5站、6-20站、20+站） |
| **功能模块** | 基础版（预测+报价+看板）/ 专业版（+回测+储能调度+高级分析）/ 旗舰版（+多模型+高级报告+储能高级优化） |
| **省份** | 每个省份的市场规则适配作为独立收费模块，因不同省份交易规则差异大，算法开发和维护成本不同 |

**MVP阶段定价：**
- 试点阶段以项目制合作为主（与中石油），暂不启用标准SaaS订阅定价
- 试点验证成功后（6个月），制定标准化SaaS订阅价格体系

## 集成清单（Integration List）

| 集成对象 | 集成方式 | 优先级 | 备注 |
|---------|---------|--------|------|
| 省级电力交易中心 | 官方API + Excel/CSV降级 | MVP | 交易数据、出清价格、结算数据 |
| 气象数据源 | API接入 | MVP | 功率预测模型输入 |
| 电站SCADA/EMS | 文件导入（试点）→ API（后期） | MVP降级 | 实时出力数据，试点阶段文件导入 |
| 储能EMS/BMS | 文件导入（MVP）→ API（Post-MVP） | MVP | SOC状态、充放电功率、设备参数、循环次数，MVP阶段文件导入 |
| 自有功率预测模型 | 标准化API | MVP | 风光功率预测 |
| 第三方预测模型 | 标准化API（预留） | Post-MVP | 即插即用的模型接入接口 |

## 合规要求（Compliance Requirements）

| 合规项 | 要求 | 实现方式 |
|--------|------|---------|
| 《数据安全法》 | 能源交易数据按三级管控 | 数据分类标记 + 加密存储传输 |
| 数据不出境 | 国资企业数据存储和处理完全在境内 | 本地/私有云部署，无境外数据传输 |
| AI决策审计 | 每笔AI建议和人工调整可追溯 | 审计日志≥3年，不可篡改 |
| 操作审计 | 关键操作全记录 | 时间戳+操作人+操作内容+变更前后值 |

## Implementation Considerations

**部署架构：**
- 容器化部署（Docker/K8s），支持客户内网和私有云环境
- 前后端分离架构，Web应用 + LangGraph多Agent引擎 + 数据层独立部署
- MVP采用Docker Compose单机部署（含langgraph-app、api-server、web-frontend、postgresql、langfuse、ollama等服务）
- 生产级扩展方案采用Kubernetes集群（LangGraph App水平扩展、GPU节点服务本地LLM）
- AI模型更新支持离线包推送（适配半离线环境），LLM模型切换仅需修改配置

**扩展性设计：**
- 省份市场规则引擎模块化，新省份适配通过配置+规则插件实现
- 预测模型接口标准化，支持热插拔
- 多Agent架构天然支持水平扩展——新增Agent或复制Agent角色不影响既有Agent
- 数据接入适配层抽象化，新数据源对接不影响核心业务逻辑
- Agent可观测性平台（自托管部署）提供全链路追踪、Token成本归因和性能监控
