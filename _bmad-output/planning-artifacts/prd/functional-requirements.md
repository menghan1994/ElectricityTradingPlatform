# Functional Requirements

## 功率预测管理

- FR1: 交易员可查看指定电站的96时段功率预测曲线及置信区间
- FR2: 交易员可切换查看不同预测模型的预测结果（MVP仅1个自有模型）
- FR3: 系统管理员可配置功率预测模型的接入参数（API端点、认证密钥、调用频率、超时时间）并监控运行状态（运行中/异常/已停用），异常时系统自动告警
- FR4: 系统通过标准化API接入自有功率预测模型，在每交易日T-1日指定时间前完成当日96时段预测数据拉取（数据字段包含时段编号、预测功率kW、置信区间上下限）；API响应超时或调用失败时系统在5分钟内发出告警并记录失败原因

## 日前报价决策

- FR5: 系统通过多Agent协作流程（预测Agent→策略Agent→储能Agent→风控Agent→协调Agent），基于功率预测、电价预测和储能状态（配有储能的电站）自动生成96时段的报量报价建议及储能充放电计划
- FR6: 交易员可查看每个时段的AI报价建议及其推荐理由（规则描述级可解释性）
- FR7: 交易员可对AI报价建议进行逐时段微调并记录调整理由
- FR8: 交易员完成所有时段报价审核后可确认最终报价方案；系统收到确认后将申报状态更新为"已提交"，自动记录确认时间戳和操作人，并触发储能调度指令生成流程（如适用）；若有时段数据缺失则阻止确认并提示具体缺失时段
- FR9: 系统识别负电价风险时段并向交易员发出预警；对配有储能的电站，同时生成储能充电建议（含预计SOC变化和后续放电窗口推荐）
- FR10: 系统记录交易员对AI建议的每次覆盖操作（含调整内容、理由、时间、操作人）
- FR50: 交易员可在电站列表视图中批量查看所负责电站的关键状态（今日申报状态、最新预测偏差、储能SOC），支持按电站名称和状态筛选
- FR51: 系统展示每日申报状态跟踪（未开始/AI建议已生成/交易员已审核/已提交），交易员可按状态筛选电站

## 历史回测与收益分析

- FR11: 交易主管可选择指定电站和自定义时间范围（支持按日/月/年），使用真实历史数据运行AI策略回测，回测结果至少包含总收益对比、逐日收益曲线和关键偏差时段列表
- FR12: 系统计算AI策略（含储能联合优化）与实际执行策略的收益差异
- FR13: 系统对收益差异进行归因分析（追溯到具体时段和具体原因），对配有储能的电站单独展示储能贡献（套利收益、偏差平滑节省、负电价避损）
- FR14: 交易主管可按自定义时间范围查看负电价专题分析，包含：负电价时段清单、各时段AI策略推荐（零出力/储能充电）、实际执行对比、避损金额汇总、储能充电贡献明细
- FR15: 交易主管可生成并导出可视化回测报告（PDF格式）
- FR16: 高管可查看管理层回测报告，展示全年或自定义时段的AI策略累计增收总额及百分比、储能贡献占比、负电价避损金额、关键月份趋势图，支持按电站筛选

## 收益看板与绩效分析

- FR17: 交易主管可按电站维度查看指定时间范围（支持日/周/月/自定义）的交易收益汇总，至少包含：总发电收益（元）、偏差考核费用（元）、净收益（元）、储能套利收益（元，仅限配有储能的电站），支持按电站和时间范围筛选
- FR18: 交易主管可查看指定时间范围内AI报价策略收益与交易员实际执行收益的对比看板（"AI策略收益"定义为以AI建议方案为输入、使用真实结算价格的回测模拟结果），至少展示：AI策略总收益、实际执行总收益、差异金额、差异百分比、逐月趋势折线图，支持按电站筛选
- FR19: 交易主管可按电站和时间范围查看偏差考核费用跟踪数据，包含：逐日偏差率及方向（正/负偏差）、偏差考核费用金额、超标时段明细、储能偏差平滑贡献量，支持按月环比分析
- FR20: 交易主管可按交易员维度查看绩效分析（含AI建议采纳率）
- FR21: 高管（角色：高管只读）可查看跨所有电站的整体收益看板，至少包含：本月/本年度累计净收益（元）、AI策略增收贡献金额及百分比、储能贡献占比、各电站净收益排名，默认展示本自然月数据，支持自定义时间范围；所有数据字段为只读展示
- FR22: 交易员可查看自己负责电站的日/月交易收益（含偏差考核费用），以及每次人工干预的收益归因明细（调整时段、调整内容、收益影响金额）
- FR53: 交易主管可按是否配备储能对电站收益进行分组对比分析，展示有储能电站组与无储能电站组的收益差异、储能增量贡献汇总（套利收益、偏差平滑节省、负电价避损）

## 数据管理与导入

- FR23: 系统管理员可通过引导式向导配置电站基本参数（装机容量、并网点、电站类型）及储能设备参数（储能容量、额定功率、充放电倍率限制、SOC运行上下限、电池类型，系统提供标准模板）
- FR24: 系统管理员可配置省份市场规则（限价范围、结算方式、偏差考核公式）
- FR25: 系统管理员可批量导入历史交易数据（Excel/CSV格式）
- FR26: 系统对导入数据进行质量校验（时段完整性、价格范围合理性、数据格式、重复检测），将异常数据按类型（缺失/格式错误/超范围/重复）标记，并展示数据完整性百分比和异常明细
- FR27: 系统管理员可按异常类型和导入批次筛选查看异常数据列表，支持单条编辑修正、批量删除和标记"已确认正常"操作，修正操作记录审计日志
- FR28: 系统通过省级电力交易中心公开API获取日前出清价格数据（每日在报价截止时间前完成当日96时段价格数据同步，数据字段包含时段编号、出清价格元/MWh）；接入失败时发出告警并记录失败日志，不影响基于历史价格的回测功能
- FR29: 系统接入电站实际出力数据——MVP阶段以文件导入为主（Excel/CSV格式，字段包含时段编号、实际出力kW、电站ID），支持按交易日批量导入；Post-MVP通过电站SCADA系统API实现准实时对接。文件导入须经过FR26定义的数据质量校验流程

## 用户与权限管理

- FR30: 系统管理员可创建用户账户（用户名、姓名、联系方式），并管理账户（编辑信息、重置密码、停用/启用账户），操作记录审计日志
- FR31: 系统管理员可为用户分配角色（管理员/交易员/储能运维员/交易主管/高管只读）
- FR32: 系统管理员可配置交易员与电站的绑定关系（支持一对多）
- FR33: 系统按角色和电站绑定关系控制用户的数据访问范围
- FR52: 系统管理员可配置储能运维员与储能设备的绑定关系（支持一对多），运维员仅可查看和操作所绑定设备的调度指令

## 储能调度管理

- FR38: 系统基于功率预测、电价预测和当前SOC状态，自动生成日前96时段储能充放电计划
- FR39: 充放电计划生成时自动校验设备约束（SOC上下限、充放电倍率），超限指令自动拦截并告警
- FR40: 交易员可查看储能充放电计划及每个时段的策略建议（充电/放电/待机）和推荐理由
- FR41: 交易员可对储能充放电计划进行逐时段微调并记录调整理由
- FR42: 交易员确认储能调度计划后，系统生成调度指令发送给储能运维员
- FR43: 储能运维员可查看待执行的调度指令（时间、功率、方向），确认执行或拒绝并反馈异常原因
- FR44: 系统展示储能SOC状态（当前SOC、预计SOC变化曲线）
- FR45: 系统实现负电价时段储能充电策略（识别负电价时段→建议储能充电→推荐后续放电窗口）
- FR46: 系统基于电价预测和设备约束，自动计算96时段的最优充放电组合方案（输出每时段充/放/待机指令及预计收益），以净收益最大化为目标函数，并展示预计套利收益金额

## 储能数据管理

- FR47: 系统管理员可通过文件导入方式（Excel/CSV）导入储能历史运行数据（SOC、充放电功率、循环次数）
- FR48: 系统管理员可通过文件导入方式更新储能当前SOC状态（每交易日至少一次）
- FR49: 系统对导入的储能数据进行质量校验（SOC范围合理性、功率数据连续性）并标记异常

## 多智能体协作

- FR54: 系统通过协调Agent统一管理预测Agent、策略Agent、储能Agent、风控Agent的协作执行顺序和数据流转，实现端到端96时段报价建议生成
- FR55: 交易员可查看Agent决策链路——每个Agent的输入摘要、输出结果、推理耗时及置信度评分，了解AI报价建议的完整生成过程
- FR56: 系统在多Agent协作完成后通过中断-恢复机制暂停等待交易员审核，交易员可批准、修改或拒绝后恢复流程继续执行（如提交申报或重新生成）
- FR57: 系统记录每次多Agent协作的完整执行链路（每个Agent的输入/输出/状态/耗时/使用的LLM模型），作为审计日志的组成部分
- FR58: 系统在Agent协作失败（Agent异常/超时60秒/输出校验失败，单次链路累计失败超过2次）时自动降级为规则引擎生成报价建议（基于电站历史报价均值和当日功率预测生成96时段基础报价），并在界面以醒目提示交易员当前处于降级模式及降级原因；降级事件自动记录至审计日志；Agent系统恢复后自动提示交易员可切换回AI建议
- FR59: 系统将多Agent协作流程的状态持久化存储，支持流程在任意Agent节点中断后从最近检查点恢复执行，无需重新运行已完成的Agent；持久化数据包含每个Agent的执行状态、输入输出快照和检查点时间戳；系统异常重启后自动恢复未完成的协作流程
- FR60: 系统提供Agent可观测性看板，展示多Agent协作的运行指标，至少包含：各Agent调用成功率、平均耗时、Token消耗趋势、协作链路失败率Top原因；系统管理员可配置告警规则（如协作成功率低于阈值、Token消耗超预算），告警通过页面通知推送；追踪数据保留≥90天

## 审计与合规

- FR34: 系统完整记录每笔AI报价建议（含储能调度建议）的Agent级别决策链路：每个Agent的输入数据、输出结果、推理过程、耗时、使用的LLM模型，以及协调Agent的调用顺序和数据流转路径
- FR35: 系统记录以下操作的审计日志（时间戳+操作人+操作内容+变更前后值）：报价方案确认/修改、储能调度计划确认/修改、储能指令确认/拒绝、用户账户创建/停用、角色分配变更、电站绑定变更、市场规则配置变更、数据导入操作
- FR36: 交易主管可按时间/电站/交易员维度检索审计日志
- FR37: 系统长期保存审计日志（≥3年），保证不可篡改
